"use strict";(self.webpackChunkNJS_Lab=self.webpackChunkNJS_Lab||[]).push([[32432],{32432:(t,e,s)=>{s.r(e),s.d(e,{Solution:()=>j});var i=s(1250),o=s(18489),r=s(5483),n=s.n(r),a=s(34648),l=s(72791),c=s(28733),h=s(27751);var d=s(80184);const p=t=>{let{mapRef:e}=t;return(0,d.jsxs)("div",{children:[(0,d.jsx)("div",{children:"menu"}),(0,d.jsx)(h.ZP,{type:"text",onClick:t=>{const s=e.getCanvas();var i;(i=e,new Promise((function(t,e){i.once("render",(function(){t(i.getCanvas().toDataURL())})),i.setBearing(i.getBearing())}))).then((t=>{const e=new Image;e.width=s.width,e.height=s.height,e.src=t;const i=document.createElement("a");i.download="fileName.png",i.href=t,i.click()}))},children:"capture"})]})};class u{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;this.p0=void 0,this.p1=void 0,this.p2=void 0,this.p3=void 0,this.N=10,this.m=new f(0,0),this.down=!1,this._capture=void 0,this.ptsList=[],this.t=0,this.projectedValues=[],this.N=t;this.p0=new f(50,150),this.p3=new f(250,50);const e=.35*(this.p3.x-this.p0.x),s=.35*(this.p3.y-this.p0.y);this.p1=new f(this.p0.x+e,this.p0.y+s),this.p2=new f(this.p3.x-e,this.p3.y-s),this.ptsList=[this.p1,this.p2]}get capture(){return this._capture}set capture(t){this._capture=t}mouseDown(t,e){this.m.x=t,this.m.y=e;for(let s=0;s<this.ptsList.length;++s){this.ptsList[s].distanceTo(this.m)<10&&(this.capture=this.ptsList[s])}}mouseUp(t,e){this.capture=void 0,this.down=!1}mouseDrag(t,e){this.m.x=t,this.m.y=e,this.capture&&(this.capture.x=t,this.capture.y=e)}project(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e=[];this.projectedValues=[];let s=1/(t-1);for(let i=0;i<t;++i){let t=g(this.p0,this.p1,this.p2,this.p3,s*i);this.projectedValues.push(v(t.y,this.p0.y,this.p3.y,0,1)),e.push(t)}return e}getProjection(){return this.projectedValues}render(t){t.clearRect(0,0,t.canvas.width,t.canvas.height),t.beginPath(),t.rect(this.p0.x,this.p3.y,200,100),t.strokeStyle="#000",t.lineWidth=1,t.stroke();let e=this.project(this.N);t.strokeStyle="#00ffff",t.lineWidth=3,t.beginPath();for(let s=0;s<e.length-1;++s)t.moveTo(e[s].x,e[s].y),t.lineTo(e[1+s].x,e[1+s].y);t.stroke(),t.strokeStyle="#000",t.lineWidth=1,t.beginPath(),t.moveTo(this.p0.x,this.p0.y),t.lineTo(this.p1.x,this.p1.y),t.stroke(),t.beginPath(),t.moveTo(this.p2.x,this.p2.y),t.lineTo(this.p3.x,this.p3.y),t.stroke(),this.p0.draw(t),this.p1.draw(t),this.p2.draw(t),this.p3.draw(t)}}class f{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=0,this.y=0,this.x=t,this.y=e}distanceTo(t){return Math.sqrt((t.x-this.x)*(t.x-this.x)+(t.y-this.y)*(t.y-this.y))}draw(t){t.fillStyle="#ffffff",t.beginPath(),t.arc(this.x,this.y,5,0,6.28318),t.closePath(),t.fill()}}const v=(t,e,s,i,o)=>(t-e)*(o-i)/(s-e)+i,y=(t,e,s,i)=>new f(i*t.x+s*e.x,i*t.y+s*e.y),g=(t,e,s,i,o)=>{const r=1-o,n=y(t,e,o,r),a=y(e,s,o,r),l=y(s,i,o,r),c=y(n,a,o,r),h=y(a,l,o,r);return y(c,h,o,r)},m=()=>{const t=(0,l.useRef)(null),[e,s]=(0,l.useState)(!1),[i,o]=(0,l.useState)(null),[r]=(0,l.useState)((()=>new u(100)));(0,l.useEffect)((()=>{const e=t.current;if(!e)return;e.width=500,e.height=500;const s=e.getContext("2d");s&&(s.fillStyle="white",s.fillRect(0,0,e.width,e.height),r.render(s))}),[]);const n=()=>{s(!1),o(null),r.mouseUp(0,0)};return(0,d.jsx)("canvas",{ref:t,width:500,height:500,onMouseDown:e=>{var i;s(!0);const n=null===(i=t.current)||void 0===i?void 0:i.getBoundingClientRect();if(n){o({x:e.clientX-n.left,y:e.clientY-n.top});const t=e.clientX-n.left,s=e.clientY-n.top;r.mouseDown(t,s)}},onMouseMove:s=>{if(!e||!i)return;const o=t.current,n=null===o||void 0===o?void 0:o.getContext("2d"),a=null===o||void 0===o?void 0:o.getBoundingClientRect();if(n&&a){const t=s.clientX-a.left,e=s.clientY-a.top;r.mouseDrag(t,e),r.render(n)}},onMouseUp:n,onMouseLeave:n,style:{cursor:"crosshair"}})};s(43161);const x="style_mapContainer__VmRBv",w="style_menu__OZNbn",_=()=>{const t=(0,l.useRef)(),[e,s]=(0,l.useState)(null);(0,l.useEffect)((()=>{(async()=>{try{const t=await fetch("/njs-lab-public/static/dataDummyReady/presidential_election_county_summary_bead.csv");if(!t.ok)throw new Error("Failed to load csv data");const e=await t.text(),i=(0,c.Kw)(e);s(i)}catch(t){console.error("Error fetching GeoJSON:",t)}})()}),[]);const i=(0,l.useCallback)((t=>{if(t<0||t>1)throw new Error("Input must be between 0 and 1.");return[Math.round(255*(1-t)),0,Math.round(255*t)]}),[]),r=(0,l.useCallback)((t=>{const s=e.find((e=>e.county_fips.toString().padStart(5,"0")===t));return s?{colorData:parseFloat(s.vote_per_D)||0,vote_per_D:s.vote_per_D,vote_per_R:s.vote_per_R,loc_pct_served:parseFloat(s.loc_pct_served)||0}:null}),[e]),[h,u]=(0,l.useState)(null),f=(0,l.useCallback)((t=>{const e=t.features&&t.features[0];u(e?(0,o.Z)((0,o.Z)({},e.properties),{},{longitude:t.lngLat.lng,latitude:t.lngLat.lat}):null)}),[]),v=(0,l.useCallback)((t=>{var e;t.target.queryRenderedFeatures(t.point);null===t||void 0===t||null===(e=t.features)||void 0===e||e.length}),[]);(0,l.useEffect)((()=>{(async()=>{try{const t=await fetch("/njs-lab-public/static/dataDummyReady/underserved_locations.geojson");if(!t.ok)throw new Error("Failed to load GeoJSON data");const e=await t.json();g(e)}catch(t){console.error("Error fetching GeoJSON:",t)}})()}),[]),(0,l.useEffect)((()=>{(async()=>{try{const t=await fetch("/njs-lab-public/static/data/us_counties.geojson");if(!t.ok)throw new Error("Failed to load GeoJSON data");const e=await t.json();k(e)}catch(t){console.error("Error fetching GeoJSON:",t)}})()}),[]);const[y,g]=(0,l.useState)({type:"FeatureCollection",features:[]}),_="my-layer-circle",j={id:_,type:"circle",paint:{"circle-radius":6,"circle-color":"#4E3FC8","circle-opacity":.8,"circle-stroke-width":2,"circle-stroke-color":"#fff"}},[b,k]=(0,l.useState)({type:"FeatureCollection",features:[]}),S="polygon-layer",R={id:S,type:"fill",paint:{"fill-color":["rgba",["get","R"],["get","G"],["get","B"],["get","O"]],"fill-opacity":.5,"fill-outline-color":"#000"}},C=(0,l.useMemo)((()=>(0,o.Z)((0,o.Z)({},b),{},{features:b.features.map((t=>{const e=r(t.properties.GEOID);if(!e)return t;const s=parseFloat(e.vote_per_R),n=parseFloat(e.vote_per_D),a=i(n/(s+n));return(0,o.Z)((0,o.Z)({},t),{},{properties:(0,o.Z)((0,o.Z)({},t.properties),{},{R:a[0],G:0,B:a[2],O:1-Math.min(e.loc_pct_served**2*1.5*1e-4,1),loc_pct_served:e.loc_pct_served,vote_per_D:e.vote_per_D,vote_per_R:e.vote_per_R})})}))})),[b,r,i,1.5]);return(0,d.jsxs)("div",{className:x,children:[(0,d.jsx)("div",{className:w,children:(0,d.jsx)(p,{mapRef:t.current})}),(0,d.jsx)(l.Suspense,{children:(0,d.jsxs)(a.ZP,{mapLib:n(),ref:t,initialViewState:{longitude:-100,latitude:40,zoom:3.5},style:{width:"100%",height:"100%",position:"relative",top:0,left:0,right:0,bottom:0,zIndex:0,flex:1},mapStyle:"mapbox://styles/mapbox/dark-v10",mapboxAccessToken:"pk.eyJ1IjoiZGVzaWduanUiLCJhIjoiY2xhNGU0YWo4MDlhYzNwdHBwenVvang4eiJ9.P3sX4l_3KjdPeRRbVS1VVg",dragRotate:!1,interactiveLayerIds:[_],onMouseMove:f,onClick:v,children:[(0,d.jsx)(a.Hw,{id:_,type:"geojson",data:y,children:(0,d.jsx)(a.mh,(0,o.Z)({},j))}),(0,d.jsx)(a.Hw,{id:S,type:"geojson",data:C,children:(0,d.jsx)(a.mh,(0,o.Z)({},R))}),h&&(0,d.jsx)(a.GI,{longitude:h.longitude,latitude:h.latitude,offset:[0,-15],closeButton:!1,className:"z-10",children:(0,d.jsxs)("div",{className:"p-2",children:[(0,d.jsx)("h3",{className:"font-bold",children:h.NAME}),(0,d.jsxs)("p",{children:["GEOID: ",JSON.stringify(h)]})]})}),(0,d.jsx)("div",{style:{position:"absolute",background:"rgba(255, 255, 255, 0.23)",width:"200px",height:"100px"},children:(0,d.jsx)(m,{})})]})})]})};class j{constructor(t){this.divHost=void 0,this.divHost=document.getElementById(t);const e=document.createElement("div");e.style.height="100%",e.style.width="100%",this.divHost.appendChild(e);i.createRoot(e).render(l.createElement(_,{}))}destroy(){try{for(;this.divHost&&this.divHost.lastElementChild;){const t=this.divHost.lastElementChild;this.divHost.removeChild(t)}}catch(t){console.error("Error removing child elements:",t)}}}}}]);
//# sourceMappingURL=32432.7a1e9264.chunk.js.map
"use strict";(self.webpackChunkNJS_Lab=self.webpackChunkNJS_Lab||[]).push([[51234],{18080:(e,t,r)=>{r.d(t,{Y:()=>o,h:()=>l});var n=r(83689),a=r(51171);function l(e){return{origin:"portal-item",url:(0,n.mN)(e.itemUrl),portal:e.portal||a.Z.getDefault(),portalItem:e,readResourcePaths:[]}}function o(e){return{origin:"portal-item",messages:[],writtenProperties:[],url:e.itemUrl?(0,n.mN)(e.itemUrl):null,portal:e.portal||a.Z.getDefault(),portalItem:e}}},51234:(e,t,r)=>{r.r(t),r.d(t,{getFirstLayerOrTableId:()=>h,getNumLayersAndTables:()=>b,getSubtypeGroupLayerIds:()=>g,load:()=>p,preprocessFSItemData:()=>m});var n=r(64299),a=r(63573),l=r(70629),o=r(51171),i=r(13358),u=r(18080),s=r(64495),c=r(54380),d=r(67033);async function p(e,t){const r=e.instance.portalItem;if(r&&r.id)return await r.load(t),function(e){const t=e.instance.portalItem;if(!e.supportedTypes.includes(t.type))throw new n.Z("portal:invalid-layer-item-type","Invalid layer item type '${type}', expected '${expectedType}'",{type:t.type,expectedType:e.supportedTypes.join(", ")})}(e),async function(e,t){const r=e.instance,a=r.portalItem,{url:l,title:o}=a,i=(0,u.h)(a);if("group"===r.type)return r.read({title:o},i),function(e,t){var r;let a;const l=e.portalItem.type,o=t.layerModuleTypeMap,i=null!==(r=(0,s._$)(e.portalItem,"Oriented Imagery Layer"))&&void 0!==r&&r;switch(l){case"Feature Service":a=i?o.OrientedImageryLayer:o.FeatureLayer;break;case"Stream Service":a=o.StreamLayer;break;case"Scene Service":a=o.SceneLayer;break;case"Feature Collection":a=o.FeatureLayer;break;default:throw new n.Z("portal:unsupported-item-type-as-group","The item type '".concat(l,"' is not supported as a 'IGroupLayer'"))}let u;return a().then((e=>(u=e,v(t)))).then((async t=>{let r=()=>u;if("Feature Service"===l){if(g(t=await m(t,e.portalItem.url)).length){const e=o.SubtypeGroupLayer,t=await e();r=e=>"SubtypeGroupLayer"===e.layerType?t:u}return y(e,r,t)}return b(t)>0?y(e,r,t):function(e,t){return e.portalItem.url?(0,d.b)(e.portalItem.url).then((r=>{var n,a;function l(e){return{id:e.id,name:e.name}}r&&y(e,t,{layers:null===(n=r.layers)||void 0===n?void 0:n.map(l),tables:null===(a=r.tables)||void 0===a?void 0:a.map(l)})})):Promise.resolve()}(e,r)}))}(r,e);l&&r.read({url:l},i);const p=await v(e,t);return p&&r.read(p,i),r.resourceReferences={portalItem:a,paths:i.readResourcePaths},"subtype-group"!==r.type&&r.read({title:o},i),(0,c.y)(r,i)}(e,t)}function y(e,t,r){let o=r.layers||[];const u=r.tables||[];if("Feature Collection"===e.portalItem.type&&(o.forEach((e=>{var t;"Table"===(null===e||void 0===e||null===(t=e.layerDefinition)||void 0===t?void 0:t.type)&&u.push(e)})),o=o.filter((e=>{var t;return"Table"!==(null===e||void 0===e||null===(t=e.layerDefinition)||void 0===t?void 0:t.type)}))),"coverage"in r){const t=function(e){const{coverage:t}=e;if(!t)return null;const r=new URL(t);if(t.toLowerCase().includes("item.html")){const e=r.searchParams.get("id"),t=r.origin;return a.Z.fromPortalItem({portalItem:new i.default({id:e,url:t})})}if((0,l.B5)(t))return a.Z.fromArcGISServerUrl({url:t});throw new n.Z("portal:oriented-imagery-layer-coverage","the provided coverage url couldn't be loaded as a layer")}(r);e.add(t)}o.reverse().forEach((n=>{const a=f(e,t(n),r,n);e.add(a)})),u.reverse().forEach((n=>{const a=f(e,t(n),r,n);e.tables.add(a)}))}function f(e,t,r,n){const a=new t({portalItem:e.portalItem.clone(),layerId:n.id});if("subtype-group"!==a.type&&(a.sublayerTitleMode="service-name"),"Feature Collection"===e.portalItem.type){const t={origin:"portal-item",portal:e.portalItem.portal||o.Z.getDefault()};a.read(n,t);const l=r.showLegend;null!=l&&a.read({showLegend:l},t)}return a}function v(e,t){if(!1===e.supportsData)return Promise.resolve(void 0);const r=e.instance;return r.portalItem.fetchData("json",t).catch((()=>null)).then((e=>{if(function(e){return"stream"!==e.type&&"oriented-imagery"!==e.type&&"layerId"in e}(r)){let t,n=!0;if(e&&b(e)>0){if(null==r.layerId){const t=g(e);r.layerId="subtype-group"===r.type?null===t||void 0===t?void 0:t[0]:h(e)}t=function(e,t){var r,n;const{layerId:a}=t,l=(null===(r=e.layers)||void 0===r?void 0:r.find((e=>e.id===a)))||(null===(n=e.tables)||void 0===n?void 0:n.find((e=>e.id===a)));return l&&function(e,t){return!("feature"===t.type&&"layerType"in e&&"SubtypeGroupLayer"===e.layerType||"subtype-group"===t.type&&!("layerType"in e))}(l,t)?l:null}(e,r),t&&(1===b(e)&&(n=!1),null!=e.showLegend&&(t.showLegend=e.showLegend))}return n&&"service-name"!==r.sublayerTitleMode&&(r.sublayerTitleMode="item-title-and-service-name"),t}return e}))}async function m(e,t){var r,n;if(null==(null===(r=e)||void 0===r?void 0:r.layers)||null==(null===(n=e)||void 0===n?void 0:n.tables)){const r=await(0,d.b)(t);(e=e||{}).layers=e.layers||(null===r||void 0===r?void 0:r.layers),e.tables=e.tables||(null===r||void 0===r?void 0:r.tables)}return e}function h(e){const t=e.layers;if(t&&t.length)return t[0].id;const r=e.tables;return r&&r.length?r[0].id:null}function b(e){var t,r,n,a;return(null!==(t=null===e||void 0===e||null===(r=e.layers)||void 0===r?void 0:r.length)&&void 0!==t?t:0)+(null!==(n=null===e||void 0===e||null===(a=e.tables)||void 0===a?void 0:a.length)&&void 0!==n?n:0)}function g(e){var t;const r=[];return null!==e&&void 0!==e&&null!==(t=e.layers)&&void 0!==t&&t.forEach((e=>{"SubtypeGroupLayer"===e.layerType&&r.push(e.id)})),r}},64495:(e,t,r)=>{r.d(t,{$o:()=>s,Kz:()=>c,_$:()=>i,ck:()=>u,qj:()=>o});var n=r(62348),a=r(74174),l=r(33917);function o(e,t){if(!i(e,t)){const r=e.typeKeywords;r?r.push(t):e.typeKeywords=[t]}}function i(e,t){var r;return!(null===(r=e.typeKeywords)||void 0===r||!r.includes(t))}function u(e,t){const r=e.typeKeywords;if(r){const e=r.indexOf(t);e>-1&&r.splice(e,1)}}async function s(e){const t=e.clone().normalize();let r;if(t.length>1)for(const n of t)r?n.width>r.width&&(r=n):r=n;else r=t[0];return async function(e){const t=e.spatialReference;if(t.isWGS84)return e.clone();if(t.isWebMercator)return(0,l.Sx)(e);const r=a.Z.WGS84;return await(0,n.iQ)(t,r),(0,n.iV)(e,r)}(r)}const c={DEVELOPER_BASEMAP:"DeveloperBasemap",JSAPI:"ArcGIS API for JavaScript",METADATA:"Metadata",MULTI_LAYER:"Multilayer",SINGLE_LAYER:"Singlelayer",TABLE:"Table"}},67033:(e,t,r)=>{r.d(t,{b:()=>a});var n=r(69279);async function a(e){const{data:t}=await(0,n.default)(e,{responseType:"json",query:{f:"json"}});return t}}}]);
//# sourceMappingURL=51234.61366b4b.chunk.js.map
"use strict";(self.webpackChunkNJS_Lab=self.webpackChunkNJS_Lab||[]).push([[58359],{58359:(t,e,i)=>{i.r(e),i.d(e,{ColorCorrection:()=>a,PRESET:()=>d,PRESET_TYPE:()=>c,Renderer:()=>h,Solution:()=>n});var r=i(55913);class s{constructor(t,e,i){this.positionBuffer=void 0,this.texCoordBuffer=void 0,this.vertexShader=void 0,this.fragmentShader=void 0,this.texture=void 0,this.canvasGL=void 0,this.img=void 0,this.program=void 0,this.gl=void 0,this.canvasGL=document.createElement("canvas"),this.canvasGL.width=t.width,this.canvasGL.height=t.height,this.gl=this.canvasGL.getContext("webgl2"),this.img=t,this.init(e,i)}get canvas(){return this.canvasGL}init(t,e){const i=this.gl;this.texture=i.createTexture(),i.bindTexture(i.TEXTURE_2D,this.texture),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,this.img),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),this.vertexShader=i.createShader(i.VERTEX_SHADER),i.shaderSource(this.vertexShader,t),i.compileShader(this.vertexShader),this.fragmentShader=i.createShader(i.FRAGMENT_SHADER),i.shaderSource(this.fragmentShader,e),i.compileShader(this.fragmentShader),this.program=i.createProgram(),i.attachShader(this.program,this.vertexShader),i.attachShader(this.program,this.fragmentShader),i.linkProgram(this.program),i.useProgram(this.program);const r=i.getAttribLocation(this.program,"a_position"),s=i.getAttribLocation(this.program,"a_texCoord"),o=i.getUniformLocation(this.program,"u_texture");i.uniform1i(o,0),this.positionBuffer=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,this.positionBuffer),i.bufferData(i.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,1]),i.STATIC_DRAW),i.enableVertexAttribArray(r),i.vertexAttribPointer(r,2,i.FLOAT,!1,0,0),this.texCoordBuffer=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,this.texCoordBuffer),i.bufferData(i.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,1,1]),i.STATIC_DRAW),i.enableVertexAttribArray(s),i.vertexAttribPointer(s,2,i.FLOAT,!1,0,0),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,this.texture)}destroy(){this.gl.deleteProgram(this.program),this.gl.deleteTexture(this.texture),this.gl.deleteShader(this.vertexShader),this.gl.deleteShader(this.fragmentShader),this.gl.deleteBuffer(this.positionBuffer),this.gl.deleteBuffer(this.texCoordBuffer)}}class o{constructor(t){this.vertexShaderSource="\n        attribute vec2 a_position;\n        attribute vec2 a_texCoord;\n        varying vec2 v_texCoord;\n\n        void main() {\n            gl_Position = vec4(a_position, 0, 1);\n            v_texCoord = a_texCoord;\n        }\n    ",this.fragmentShaderSource="\n        precision mediump float;\n        \n        uniform vec2 u_resolution;\n        uniform float u_blurRadius;\n        uniform float u_sepia;\n        uniform float u_contrast;\n        uniform float u_brightness;\n        uniform float u_saturation;\n        uniform float u_hueRotation;\n        uniform sampler2D u_texture;\n        varying vec2 v_texCoord;\n\n        vec4 blur5(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n            vec4 color = vec4(0.0);\n            vec2 off1 = vec2(1.3333333333333333) * direction;\n            color += texture2D(image, uv) * 0.29411764705882354;\n            color += texture2D(image, uv + (off1 / resolution)) * 0.35294117647058826;\n            color += texture2D(image, uv - (off1 / resolution)) * 0.35294117647058826;\n            return color; \n        }\n\n        void main() {\n            vec2 flippedTexCoord = vec2(v_texCoord.x, 1.0 - v_texCoord.y);\n            vec4 color = texture2D(u_texture, flippedTexCoord);\n\n            float gray = dot(color.rgb, vec3(0.299, 0.587, 0.114));\n\n            // ..................\n            if (u_sepia > .0) {\n                vec3 sepia = vec3(1.0, 0.95, 0.82);\n                color = mix(color, vec4(gray * sepia, color.a), u_sepia);\n            }\n\n\n            // ..................\n            // if ((u_brightness != 1.0) || (u_contrast != 1.0)) {\n                vec3 colorRgb = color.rgb * u_brightness;\n                colorRgb = (colorRgb - vec3(0.5)) * max(u_contrast, 0.0) + vec3(0.5);\n                color = vec4(colorRgb, color.a);\n            // }\n\n\n            // ..................\n            color = vec4(mix(vec3(gray), color.rgb, u_saturation), color.a);\n\n            \n            // ..................\n            if (u_hueRotation != .0){\n                float angle = u_hueRotation * 3.14159265358979323846264 / 180.0;\n                float s = sin(angle);\n                float c = cos(angle);\n                mat3 hueRotationMatrix = mat3(\n                    0.213 + 0.787 * c - 0.213 * s, 0.715 - 0.715 * c - 0.715 * s, 0.072 - 0.072 * c + 0.928 * s,\n                    0.213 - 0.213 * c + 0.143 * s, 0.715 + 0.285 * c + 0.140 * s, 0.072 - 0.072 * c - 0.283 * s,\n                    0.213 - 0.213 * c - 0.787 * s, 0.715 - 0.715 * c + 0.715 * s, 0.072 + 0.928 * c + 0.072 * s\n                );\n                colorRgb = color.rgb * hueRotationMatrix;\n                color = vec4(colorRgb, color.a);\n            }\n\n            // ..................\n            gl_FragColor = color;\n        }\n    ",this.img=void 0,this.params={blur:0,sepia:0,contrast:1,brightness:1,saturate:1,hueRotate:0},this.core=void 0,this.img=t,this.core=new s(t,this.vertexShaderSource,this.fragmentShaderSource)}applyFilter(t,e){this.params=e;const i=this.core.gl,r=i.getUniformLocation(this.core.program,"u_sepia");i.uniform1f(r,this.params.sepia);const s=i.getUniformLocation(this.core.program,"u_saturation");i.uniform1f(s,this.params.saturate);const o=i.getUniformLocation(this.core.program,"u_brightness");i.uniform1f(o,this.params.brightness);const a=i.getUniformLocation(this.core.program,"u_contrast");i.uniform1f(a,this.params.contrast);const n=i.getUniformLocation(this.core.program,"u_hueRotation");i.uniform1f(n,this.params.hueRotate);const h=i.getUniformLocation(this.core.program,"u_blurRadius");i.uniform1f(h,1.8);const c=i.getUniformLocation(this.core.program,"u_resolution");i.uniform2f(c,i.canvas.width,i.canvas.height),i.drawArrays(i.TRIANGLE_STRIP,0,4),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(this.core.canvas,0,0)}destroy(){this.core.destroy()}}let a;!function(t){t.AutoContrast="autoContrast",t.None="None"}(a||(a={}));class n{constructor(t){this.divHost=void 0,this.renderer=void 0,this.divHost=document.getElementById(t),this.divHost.style.display="flex",this.divHost.style.alignItems="center";const e=document.createElement("div");e.style.marginLeft="auto",e.style.marginRight="auto",e.style.backgroundColor="#555",e.style.margin="50px",e.style.background="rgba(0,0,0,0)",this.divHost.appendChild(e),this.renderer=new h(e)}destroy(){for(this.renderer.destroy();this.divHost.lastElementChild;)this.divHost.removeChild(this.divHost.lastElementChild)}}class h extends r.bb{constructor(t){super(t),this.img=void 0,this.rotation=0,this.m=[0,0],this.switch=!0,this.isDithering=!1,this.typeCorrection=a.AutoContrast,this.params={blur:0,sepia:0,contrast:1,brightness:1,saturate:1,hueRotate:0},this.cFilter=void 0,this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0}),this.isStatic=!0,this.canvas.style.position="relative",this.canvas.style.width="100%",this.canvas.style.height="100%";let e=new Image(20,20);e.src="/njs-lab-public/static/svg/moon.svg",t.appendChild(e),(0,r.t4)("https://www.glenstone.org/wp-content/uploads/2018/07/AV_Landscape-Hero-Contour-2993-1276x800.jpg").then((t=>{t&&(this.img=t,this.img.onload=e=>{this.update(t)})}));const i=document.createElement("input");i.value="https://upload.wikimedia.org/wikipedia/commons/f/ff/Mozilla_Firefox_logo_2013.png",i.addEventListener("keydown",(t=>{"Enter"===t.code&&(0,r.t4)(i.value).then((t=>{t&&(this.img=t,this.img.onload=e=>{this.update(t)})}))})),this.divHost.appendChild(i);const s=u((t=>{this.img=t,this.img.onload=e=>{this.update(t)}}));this.divHost.appendChild(s);const o=l("saturate",0,200);o.slider.defaultValue="100",this.divHost.appendChild(o.div),o.slider.oninput=()=>{const t=.01*parseInt(o.slider.value);this.params.saturate=t,this.render(this.ctx)};const n=l("hueRotate",-360,360);n.slider.defaultValue="0",this.divHost.appendChild(n.div),n.slider.oninput=()=>{const t=1*parseInt(n.slider.value);this.params.hueRotate=t,this.render(this.ctx)};const h=l("contrast",0,20);h.slider.defaultValue="10",this.divHost.appendChild(h.div),h.slider.oninput=()=>{const t=.1*parseInt(h.slider.value);this.params.contrast=t,this.render(this.ctx)};const c=l("brightness",0,20);c.slider.defaultValue="10",this.divHost.appendChild(c.div),c.slider.oninput=()=>{const t=.1*parseInt(c.slider.value);this.params.brightness=t,this.render(this.ctx)};const d=l("sepia",0,100);d.slider.defaultValue="0",this.divHost.appendChild(d.div),d.slider.oninput=()=>{const t=.01*parseInt(d.slider.value);this.params.sepia=t,this.render(this.ctx)};const m=document.createElement("button");this.divHost.appendChild(m),m.style.width="50px",m.style.height="50px",m.textContent="Reset",m.onclick=()=>{this.resetParam(),this.render(this.ctx)};const g=document.createElement("button");this.divHost.appendChild(g),g.style.width="50px",g.style.height="50px",g.textContent="preset",g.onclick=()=>{this.renderWithPreset(),this.render(this.ctx)},this.start()}update(t){this.img=t,this.canvas.width=this.img.width,this.canvas.height=this.img.height,this.cFilter&&this.cFilter.destroy(),this.cFilter=new o(this.img),this.render(this.ctx)}render(t){if(void 0===this.img||void 0===this.cFilter)return;const e=this.params;this.cFilter.applyFilter(t,e)}renderWithPreset(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"inkwell";this.resetParam();for(let e in d[t])this.params[e]=d[t][e]}resetParam(){this.params={blur:0,sepia:0,contrast:1,brightness:1,saturate:1,hueRotate:0}}destroyPost(){this.cFilter.destroy()}}const c={aden:"aden",poprocket:"poprocket",inkwell:"inkwell"},d={aden:{sepia:.35,contrast:1.1,brightness:1.2},poprocket:{sepia:.15,brightness:1.2},inkwell:{saturate:0,contrast:.85,brightness:1.25}},l=(t,e,i)=>{const r=document.createElement("div");r.style.display="flex";const s=document.createElement("input");s.type="range",s.min="".concat(e),s.max="".concat(i);const o=document.createElement("div");return o.textContent=t,o.style.color="#aaa",r.appendChild(s),r.appendChild(o),{div:r,slider:s,text:o}},u=t=>{const e=document.createElement("input");return e.type="file",e.addEventListener("change",(e=>{const i=e.target.files[0];if(i){const e=new FileReader;e.onload=e=>{const i=new Image;i.src=e.target.result,t(i)},e.readAsDataURL(i)}})),e}}}]);
//# sourceMappingURL=58359.78a45188.chunk.js.map
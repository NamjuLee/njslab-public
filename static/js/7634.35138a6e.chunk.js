"use strict";(self.webpackChunkNJS_Lab=self.webpackChunkNJS_Lab||[]).push([[7634],{27898:(t,e,n)=>{n.d(e,{Hq:()=>Z,Mk:()=>m,P_:()=>W,Qp:()=>q,VO:()=>P,_D:()=>R,kZ:()=>K,kr:()=>Y,nF:()=>C,tB:()=>O,ut:()=>U,vF:()=>J,zD:()=>k});var i,a,s=n(18489),r=(n(75254),n(64299)),o=n(94452),l=n(69621),c=n(90320),h=n(62348),u=n(37299),f=n(42836),d=n(13925),p=n(74174);function m(t,e,n){return!(0,h.Up)(t,e,n)}function g(t,e,n){const i=m(t,e,n);if(i&&!(0,h.kR)())throw new r.Z("rasterprojectionhelper-project","projection engine is not loaded");return i}(a=i||(i={}))[a.None=0]="None",a[a.North=1]="North",a[a.South=2]="South",a[a.Both=3]="Both";const x=function(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(1===n[0])return[0,0];let a=1,s=-1,r=1,o=-1;for(let g=0;g<t.length;g+=2)isNaN(t[g])||(a=a>t[g]?t[g]:a,s=s>t[g]?s:t[g],r=r>t[g+1]?t[g+1]:r,o=o>t[g+1]?o:t[g+1]);const{cols:l,rows:c}=e,h=(s-a)/l/n[0],u=(o-r)/c/n[1],f=2*i;let d=0,p=!1,m=[0,0];for(let g=0;g<l-3;g++){for(let e=0;e<c-3;e++){const n=g*c*2+2*e,i=(t[n]+t[n+4]+t[n+4*c]+t[n+4*c+4])/4,a=(t[n+1]+t[n+5]+t[n+4*c+1]+t[n+4*c+5])/4,s=Math.abs((i-t[n+2*c+2])/h),r=Math.abs((a-t[n+2*c+3])/u);if(s+r>d&&(d=s+r,m=[s,r]),f&&d>f){p=!0;break}}if(p)break}return m},y={3395:20037508.342789244,3410:17334193.943686873,3857:20037508.342788905,3975:17367530.445161372,4087:20037508.342789244,4088:20015108.787169147,6933:17367530.445161372,32662:20037508.342789244,53001:20015086.79602057,53002:10007543.39801029,53003:20015086.79602057,53004:20015086.79602057,53016:14152803.599503474,53017:17333573.624304302,53034:20015086.79602057,53079:20015114.352186374,53080:20015114.352186374,54001:20037508.342789244,54002:10018754.171394624,54003:20037508.342789244,54004:20037508.342789244,54016:14168658.027268292,54017:17367530.44516137,54034:20037508.342789244,54079:20037508.342789244,54080:20037508.342789244,54100:20037508.342789244,54101:20037508.342789244},_=32,w=4,v=w,M=new Map,b=new Map,S=500;async function k(){(0,h.kR)()||await(0,h.zD)()}function R(t,e,n){return g(t.spatialReference,e)?n?(0,h.rS)(e,t.spatialReference,t):(0,h.rS)(t.spatialReference,e,t):null}function P(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const a=t.spatialReference;if(a.equals(e))return t;g(a,e,i);const s=n.center,r=new u.Z({xmin:s.x-t.x/2,xmax:s.x+t.x/2,ymin:s.y-t.y/2,ymax:s.y+t.y/2,spatialReference:a}),c=(0,h.iV)(r,e,i),f=U(e);let d;if((0,o.Wi)(c)||(0,o.pC)(f)&&c.width>=f){const n=(0,l.c9)(a)/(0,l.c9)(e);d={x:t.x*n,y:t.y*n}}else d={x:c.width,y:c.height};return d}function A(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.01;return(0,l.c9)(t)?e/(0,l.c9)(t):0}function C(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const a=t.spatialReference;if(a.equals(e))return t;g(a,e,n);const s=(0,h.iV)(t,e,n);return i&&s?(D([t],[s],a,e),s):s}function D(t,e,n,i){const a=L(n,!0),s=L(i,!0),r=A(n,S),l=A(i,S);if(r&&(0,o.pC)(a)&&(0,o.pC)(s))for(let o=0;o<t.length;o++){const n=e[o];if(!n)continue;const{x:i}=t[o],{x:c}=n;c>=s[1]-l&&Math.abs(i-a[0])<r?n.x-=s[1]-s[0]:c<=s[0]+l&&Math.abs(i-a[1])<r&&(n.x+=s[1]-s[0])}}function I(t){const{inSR:e,outSR:n,datumTransformation:i,preferPE:a}=t;if(e.equals(n)){const{points:e}=z(t,null);return e}if(e.isWebMercator&&n.isWGS84||e.isWGS84&&n.isWebMercator)return function(t){const{cols:e,rows:n,xres:i,yres:a,usePixelCenter:s,inSR:r,outSR:o}=t;let{xmin:l,ymax:c}=t;s&&(l+=i/2,c-=a/2);const u=[],d=[],p=Math.max(e,n);for(let g=0;g<p;g++){const t=l+i*Math.min(e,g),s=c-a*Math.min(n,g),p=(0,h.iV)(new f.Z({x:t,y:s,spatialReference:r}),o);g<=e&&u.push(p.x),g<=n&&d.push(p.y)}const m=[];for(let h=0;h<e;h++)for(let t=0;t<n;t++)m.push([u[h],d[t]]);return m}(t);if(g(e,n,i)&&a){if(e.isGeographic)return T(t);const n=F(e);if((0,o.pC)(n))return T(t)}return function(t){const{points:e}=z(t,null),{inSR:n,outSR:i,datumTransformation:a}=t,s=e.map((t=>new f.Z(t[0],t[1],n))),r=(0,h.iV)(s,i,a);return a&&D(s,r,n,i),r.map((t=>t?[t.x,t.y]:[NaN,NaN]))}(t)}function T(t){const{inSR:e,outSR:n,datumTransformation:i}=t,a=F(e),{points:s,mask:r}=z(t,a);if(!e.isGeographic){const t=e.wkid?c.e.coordsys(e.wkid):c.e.fromString(e.isGeographic?c.f.PE_TYPE_GEOGCS:c.f.PE_TYPE_PROJCS,e.wkt);c.g.projToGeog(t,s.length,s)}if((0,o.pC)(i)&&i.steps.length){let t;const e=179.9955;if(n.isGeographic&&(t=s.map((t=>{let[n]=t;return n>e?1:n<-e?-1:0}))),i.steps.forEach((t=>{const e=t.wkid?c.e.geogtran(t.wkid):c.e.fromString(c.f.PE_TYPE_GEOGTRAN,t.wkt);c.h.geogToGeog(e,s.length,s,null,t.isInverse?c.f.PE_TRANSFORM_2_TO_1:c.f.PE_TRANSFORM_1_TO_2)})),t)for(let n=0;n<s.length;n++){const i=t[n],a=s[n][0],r=a>e?1:a<-e?-1:0;i&&r&&i!==r&&(s[n][0]=i>0?a+360:a-360)}}if(!n.isGeographic){const t=F(n,!0),e=(0,o.pC)(t)&&t.isEnvelope?[t.bbox[1],t.bbox[3]]:[-90,90];!function(t,e){const[n,i]=e;for(let a=0;a<t.length;a++){const e=t[a][1];(e<n||e>i)&&(t[a]=[NaN,NaN])}}(s,e);const i=n.wkid?c.e.coordsys(n.wkid):c.e.fromString(n.isGeographic?c.f.PE_TYPE_GEOGCS:c.f.PE_TYPE_PROJCS,n.wkt);c.g.geogToProj(i,s.length,s)}let l=s;if(r&&s.length!==r.length){l=[];for(let t=0,e=0;t<r.length;t++)r[t]?l.push(s[e++]):l.push([NaN,NaN])}return l}function F(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=t.wkid||t.wkt;if(!n||t.isGeographic)return null;if(n=String(n),M.has(n)){const t=M.get(n);return e?null===t||void 0===t?void 0:t.gcs:null===t||void 0===t?void 0:t.pcs}const i=t.wkid?c.e.coordsys(t.wkid):c.e.fromString(t.isGeographic?c.f.PE_TYPE_GEOGCS:c.f.PE_TYPE_PROJCS,t.wkt),a=E(i,A(t,1e-4)),s=E(i,0,!0);return M.set(n,{pcs:a,gcs:s}),e?s:a}function E(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=c.j.generate(t),a=n?t.horizonGcsGenerate():t.horizonPcsGenerate();if(!i||null===a||void 0===a||!a.length)return null;let s=!1,r=a.find((t=>1===t.getInclusive()&&1===t.getKind()));if(!r){if(r=a.find((t=>1===t.getInclusive()&&0===t.getKind())),!r)return null;s=!0}const o=n?0:(2===i.getNorthPoleLocation()?1:0)|(2===i.getSouthPoleLocation()?2:0),l=i.isPannableRectangle(),h=r.getCoord();if(s)return{isEnvelope:s,isPannable:l,vertices:h,coef:null,bbox:[h[0][0]-e,h[0][1]-e,h[1][0]+e,h[1][1]+e],poleLocation:o};let u=0;const f=[];let[d,p]=h[0],[m,g]=h[0];for(let c=0,x=h.length;c<x;c++){u++,u===x&&(u=0);const[t,e]=h[c],[n,i]=h[u];if(i===e)f.push([t,n,e,i,2]);else{const a=(n-t)/(i-e||1e-4),s=t-a*e;e<i?f.push([a,s,e,i,0]):f.push([a,s,i,e,1])}d=d<t?d:t,p=p<e?p:e,m=m>t?m:t,g=g>e?g:e}return{isEnvelope:!1,isPannable:l,vertices:h,coef:f,bbox:[d,p,m,g],poleLocation:o}}function z(t,e){const n=[],{cols:i,rows:a,xres:s,yres:r,usePixelCenter:l}=t;let{xmin:c,ymax:h}=t;if(l&&(c+=s/2,h-=r/2),(0,o.Wi)(e)){for(let t=0;t<i;t++)for(let e=0;e<a;e++)n.push([c+s*t,h-r*e]);return{points:n}}const u=new Uint8Array(i*a);if(e.isEnvelope){const{bbox:[t,o,l,f]}=e;for(let d=0,p=0;d<i;d++){const i=c+s*d,m=e.isPannable||i>=t&&i<=l;for(let t=0;t<a;t++,p++){const e=h-r*t;m&&e>=o&&e<=f&&(n.push([i,e]),u[p]=1)}}return{points:n,mask:u}}const f=e.coef,d=[];for(let o=0;o<a;o++){const t=h-r*o,e=[],n=[];for(let a=0;a<f.length;a++){const[i,s,r,o,l]=f[a];if(t===r&&r===o)e.push(i),e.push(s),n.push(2),n.push(2);else if(t>=r&&t<=o){const a=i*t+s;e.push(a),n.push(l)}}let i=e;if(e.length>2){let t=2===n[0]?0:n[0],a=e[0];i=[];for(let s=1;s<n.length;s++)2===n[s]&&s!==n.length-1||(n[s]!==t&&(i.push(0===t?Math.min(a,e[s-1]):Math.max(a,e[s-1])),t=n[s],a=e[s]),s===n.length-1&&i.push(0===n[s]?Math.min(a,e[s]):Math.max(a,e[s])));i.sort(((t,e)=>t-e))}else e[0]>e[1]&&(i=[e[1],e[0]]);d.push(i)}for(let o=0,p=0;o<i;o++){const t=c+s*o;for(let e=0;e<a;e++,p++){const i=h-r*e,a=d[e];if(2===a.length)t>=a[0]&&t<=a[1]&&(n.push([t,i]),u[p]=1);else if(a.length>2){let e=!1;for(let n=0;n<a.length;n+=2)if(t>=a[n]&&t<=a[n+1]){e=!0;break}e&&(n.push([t,i]),u[p]=1)}}}return{points:n,mask:u}}function V(t){const e=U(t[0].spatialReference);if(t.length<2||(0,o.Wi)(e))return t[0];let{xmin:n,xmax:i,ymin:a,ymax:s}=t[0];for(let r=1;r<t.length;r++){const n=t[r];i=n.xmax+e*r,a=Math.min(a,n.ymin),s=Math.max(s,n.ymax)}return new u.Z({xmin:n,xmax:i,ymin:a,ymax:s,spatialReference:t[0].spatialReference})}function O(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const s=t.spatialReference;if(s.equals(e))return t;const r=Z(t),l=U(s,!0),c=U(e);if(0===r||(0,o.Wi)(l)||(0,o.Wi)(c)){const r=N(t,e,n,a);if((0,o.Wi)(l)&&(0,o.pC)(c)&&Math.abs(r.width-c)<A(e)&&(0,h.kR)()){const n=F(s);if((0,o.pC)(n)&&n.poleLocation===i.None&&t.width<(n.bbox[2]-n.bbox[0])/2)return function(t,e){const n=U(e);if((0,o.Wi)(n))return null;let{xmin:i,ymin:a,xmax:s,ymax:r}=t;const l=t.spatialReference,c=new d.Z({spatialReference:l,rings:[[[i,a],[s,a],[s,r],[i,r],[i,a]]]}),f=(0,h.iV)(c,e);if(2!==f.rings.length||!f.rings[0].length||!f.rings[1].length)return null;const{rings:p}=f,m=A(l),g=new u.Z({spatialReference:e});for(let o=0;o<2;o++){i=s=p[o][0][0],a=r=p[o][0][1];for(let t=0;t<p[o].length;t++)i=i>p[o][t][0]?p[o][t][0]:i,s=s<p[o][t][0]?p[o][t][0]:s,a=a>p[o][t][1]?p[o][t][1]:a,r=r<p[o][t][1]?p[o][t][1]:r;if(0===o)g.ymin=a,g.ymax=r,g.xmin=i,g.xmax=s;else if(g.ymin=Math.min(g.ymin,a),g.ymax=Math.max(g.ymax,r),Math.abs(s-n/2)<m)g.xmin=i,g.xmax=g.xmax+n;else{if(!(Math.abs(i+n/2)<m))return null;g.xmax=s+n}}return g}(t,e)||r}return r}const f=t.clone().normalize();if(1===f.length&&t.xmax<l&&t.xmax-l/2>A(s)){const{xmin:e,xmax:n}=t;for(let i=0;i<=r;i++){const a=0===i?e:-l/2,o=i===r?n-l*i:l/2;f[i]=new u.Z({xmin:a,xmax:o,ymin:t.ymin,ymax:t.ymax,spatialReference:s})}}return V(f.map((t=>N(t,e,n,a))).filter(o.pC))}function N(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const s=t.spatialReference;if(s.equals(e)||!e)return t;g(s,e,n);const r=(0,h.iV)(t,e,n);if(a&&e.isWebMercator&&r&&(r.ymax=Math.min(20037508.342787,r.ymax),r.ymin=Math.max(-20037508.342787,r.ymin),r.ymin>=r.ymax))return null;if(!i||!r)return r;const l=L(s,!0),c=L(e,!0);if((0,o.Wi)(l)||(0,o.Wi)(c))return r;const u=A(s,.001),d=A(s,S),p=A(e,.001);if(Math.abs(r.xmin-c[0])<p&&Math.abs(r.xmax-c[1])<p){const i=Math.abs(t.xmin-l[0]),a=Math.abs(l[1]-t.xmax);if(i<u&&a>d){r.xmin=c[0];const i=[];i.push(new f.Z(t.xmax,t.ymin,s)),i.push(new f.Z(t.xmax,(t.ymin+t.ymax)/2,s)),i.push(new f.Z(t.xmax,t.ymax,s));const a=i.map((t=>C(t,e,n))).filter((t=>!isNaN(null===t||void 0===t?void 0:t.x))).map((t=>t.x));r.xmax=Math.max.apply(null,a)}if(a<u&&i>d){r.xmax=c[1];const i=[];i.push(new f.Z(t.xmin,t.ymin,s)),i.push(new f.Z(t.xmin,(t.ymin+t.ymax)/2,s)),i.push(new f.Z(t.xmin,t.ymax,s));const a=i.map((t=>C(t,e,n))).filter((t=>!isNaN(null===t||void 0===t?void 0:t.x))).map((t=>t.x));r.xmin=Math.min.apply(null,a)}}else{const t=A(e,.001);Math.abs(r.xmin-c[0])<t&&(r.xmin=c[0]),Math.abs(r.xmax-c[1])<t&&(r.xmax=c[1])}return r}function U(t){if(!t)return null;const e=arguments.length>1&&void 0!==arguments[1]&&arguments[1]?20037508.342787:20037508.342788905;return t.isWebMercator?2*e:t.wkid&&t.isGeographic?360:2*y[t.wkid]||null}function L(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t.isGeographic)return[-180,180];const n=U(t,e);return(0,o.pC)(n)?[-n/2,n/2]:null}function G(t,e,n,i){let a=(t-e)/n;return a-Math.floor(a)!=0?a=Math.floor(a):i&&(a-=1),a}function Z(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=U(t.spatialReference);if((0,o.Wi)(n))return 0;const i=e?0:-n/2,a=A(t.spatialReference),s=!e&&Math.abs(t.xmax-n/2)<a?n/2:t.xmax,r=!e&&Math.abs(t.xmin+n/2)<a?-n/2:t.xmin;return G(s,i,n,!0)-G(r,i,n,!1)}function W(t){const e=t.storageInfo.origin.x,n=U(t.spatialReference,!0);if((0,o.Wi)(n))return{originX:e,halfWorldWidth:null,pyramidsInfo:null};const i=n/2,{nativePixelSize:a,storageInfo:s,extent:r}=t,{maximumPyramidLevel:l,blockWidth:c,pyramidScalingFactor:h}=s;let u=a.x;const f=[],d=(0,o.pC)(t.transform)&&"gcs-shift"===t.transform.type,p=e+(d?0:i),m=d?n-e:i-e;for(let o=0;o<=l;o++){const t=(r.xmax-e)/u/c,n=t-Math.floor(t)==0?t:Math.ceil(t),i=m/u/c,a=i-Math.floor(i)==0?i:Math.ceil(i),s=Math.floor(p/u/c),o=Math.round(p/u)%c,l=(c-Math.round(m/u)%c)%c;f.push({resolutionX:u,blockWidth:c,datsetColumnCount:n,worldColumnCountFromOrigin:a,leftMargin:o,rightPadding:l,originColumnOffset:s}),u*=h}return{originX:e,halfWorldWidth:i,pyramidsInfo:f,hasGCSSShiftTransform:d}}function q(t){const e=t.isAdaptive&&null==t.spacing;let n=t.spacing||[_,_],i=B(t),a={cols:i.size[0]+1,rows:i.size[1]+1};const r=i.outofBoundPointCount>0&&i.outofBoundPointCount<i.offsets.length/2;let l=i.outofBoundPointCount===i.offsets.length/2||e&&r?[0,0]:x(i.offsets,a,n,v);const h=(l[0]+l[1])/2,u=t.projectedExtent.spatialReference,f=t.srcBufferExtent.spatialReference;if(e&&(r||h>v)&&(m(u,f,t.datumTransformation)&&(u.isGeographic||(0,o.pC)(F(u))),n=[w,w],i=B((0,s.Z)((0,s.Z)({},t),{},{spacing:n})),a={cols:i.size[0]+1,rows:i.size[1]+1},l=x(i.offsets,a,n,v)),i.error=l,n[0]>1&&(i.coefficients=j(i.offsets,a,r)),t.includeGCSGrid&&!u.isGeographic&&!u.isWebMercator)if(f.isGeographic)i.gcsGrid={offsets:i.offsets,coefficients:i.coefficients,spacing:n};else{const e=F(u);if((0,o.pC)(e)&&!e.isEnvelope){const e=function(t){if(!t||t.isGeographic)return t;const e=String(t.wkid||t.wkt);let n;return b.has(e)?n=b.get(e):(n=(t.wkid?c.e.coordsys(t.wkid):c.e.fromString(c.f.PE_TYPE_PROJCS,t.wkt)).getGeogcs().getCode(),b.set(e,n)),new p.Z({wkid:n})}(u),o=O(t.projectedExtent,e),{offsets:l}=B((0,s.Z)((0,s.Z)({},t),{},{srcBufferExtent:o,spacing:n})),h=j(l,a,r);i.gcsGrid={offsets:l,coefficients:h,spacing:n}}}return i}function B(t){const{projectedExtent:e,srcBufferExtent:n,pixelSize:i,datumTransformation:a,rasterTransform:s}=t,r=e.spatialReference,l=n.spatialReference,c=g(r,l),{xmin:h,ymin:u,xmax:d,ymax:p}=e,m=U(l),x=(0,o.pC)(m)&&(t.hasWrapAround||"gcs-shift"===(null===s||void 0===s?void 0:s.type)),y=t.spacing||[_,_],v=y[0]*i.x,M=y[1]*i.y,b=1===y[0],k=Math.ceil((d-h)/v-.1/y[0])+(b?0:1),R=Math.ceil((p-u)/M-.1/y[1])+(b?0:1),P=I({cols:k,rows:R,xmin:h,ymax:p,xres:v,yres:M,inSR:r,outSR:l,datumTransformation:a,preferPE:y[0]<=w,usePixelCenter:b}),C=[];let D,T=0;const E=b?-1:NaN,{xmin:z,xmax:V,ymax:O,width:N,height:L}=n,G=A(l,S),Z=(0,o.pC)(m)&&z>0&&V>m/2;let W=!1;if(c){const t=F(r);W=(0,o.pC)(t)&&t.poleLocation>0}for(let o=0;o<k;o++){const t=[];for(let e=0;e<R;e++){let n=P[o*R+e];if(x&&n[0]>V&&n[0]>m/2-G?n[0]-=m:x&&0===o&&n[0]<0&&Z&&!s&&(n[0]+=m),!n||isNaN(n[0])||isNaN(n[1]))C.push(E),C.push(E),t.push(null),T++;else{if(s){const t=s.inverseTransform(new f.Z({x:n[0],y:n[1],spatialReference:l}));n=[t.x,t.y]}t.push(n),o>0&&x&&D[e]&&n[0]<D[e][0]&&(n[0]+=m,W&&n[0]>V&&n[0]>m&&(n[0]-=m)),C.push((n[0]-z)/N),C.push((O-n[1])/L)}}D=t}return{offsets:C,error:null,coefficients:null,outofBoundPointCount:T,spacing:y,size:b?[k,R]:[k-1,R-1]}}function j(t,e,n){const{cols:i,rows:a}=e,s=new Float32Array((i-1)*(a-1)*2*6),r=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),o=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let l=0;l<i-1;l++){for(let e=0;e<a-1;e++){let n=l*a*2+2*e;const c=t[n],h=t[n+1],u=t[n+2],f=t[n+3];n+=2*a;const d=t[n],p=t[n+1],m=t[n+2],g=t[n+3];let x=0,y=12*(e*(i-1)+l);for(let t=0;t<3;t++)s[y++]=r[x++]*c+r[x++]*u+r[x++]*m;x=0;for(let t=0;t<3;t++)s[y++]=r[x++]*h+r[x++]*f+r[x++]*g;x=0;for(let t=0;t<3;t++)s[y++]=o[x++]*c+o[x++]*d+o[x++]*m;x=0;for(let t=0;t<3;t++)s[y++]=o[x++]*h+o[x++]*p+o[x++]*g}if(n)for(let t=0;t<s.length;t++)isNaN(s[t])&&(s[t]=-1)}return s}function K(t){const e=t.clone().normalize();return 1===e.length?e[0]:V(e)}function Y(t,e,n){const{storageInfo:i,pixelSize:a}=e;let s=0,r=!1;const{pyramidResolutions:c}=i;if((0,o.pC)(c)&&c.length){const i=(t.x+t.y)/2,o=c[c.length-1],h=(o.x+o.y)/2,u=(a.x+a.y)/2;if(i<=u)s=0;else if(i>=h)s=c.length,r=i/h>8;else{let t,e=u;for(let a=1;a<=c.length;a++){if(t=(c[a-1].x+c[a-1].y)/2,i<=t){i===t?s=a:"down"===n?(s=a-1,r=i/e>8):s="up"===n||i-e>t-i||i/e>2?a:a-1;break}e=t}}const d=0===s?a:c[s-1];return r&&Math.min(d.x,d.y)*(0,l.c9)(e.spatialReference)>19567&&(r=!1),{pyramidLevel:s,pyramidResolution:new f.Z({x:d.x,y:d.y,spatialReference:e.spatialReference}),excessiveReading:r}}const h=Math.log(t.x/a.x)/Math.LN2,u=Math.log(t.y/a.y)/Math.LN2,d=e.storageInfo.maximumPyramidLevel||0;s="down"===n?Math.floor(Math.min(h,u)):"up"===n?Math.ceil(Math.max(h,u)):Math.round((h+u)/2),s<0?s=0:s>d&&(r=s>d+3,s=d);const p=2**s;return{pyramidLevel:s,pyramidResolution:new f.Z({x:p*e.nativePixelSize.x,y:p*e.nativePixelSize.y,spatialReference:e.spatialReference}),excessiveReading:r}}function J(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:512,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const{extent:a,spatialReference:s,pixelSize:r}=t,c=P(new f.Z({x:r.x,y:r.y,spatialReference:s}),e,a);if(null==c)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};const h=(c.x+c.y)/2,u=(0,l.c9)(e),d=h*u*96*39.37,p=e.isGeographic?256/n*295828763.7958547:256/n*591657527.591555;let m="vector-magdir"===t.dataType||"vector-uv"===t.dataType;const g=O(a,e),x=Math.min(Math.ceil(Math.log(Math.min(t.width,t.height)/32)/Math.LN2),Math.ceil(Math.log(p/2/d)/Math.LN2));if(!m&&i&&(e.isGeographic||e.isWebMercator)&&(m=g.xmin*g.xmax<0,!m&&x<3)){const t=U(e);if((0,o.pC)(t)){const e=2**x*h*n,i=Math.ceil(t/e);m=1===i||2===i&&t/2-g.xmax<e}}let y,_=d;const w=1.001;if(m){_=p;const t=e.isGeographic?1341104507446289e-21:.29858214164761665,n=t*(96*u*39.37),i=e.isGeographic?4326:3857;y=P(new f.Z({x:t,y:t,spatialReference:{wkid:i}}),s,g),y.x*=_/n,y.y*=_/n}else{y={x:r.x,y:r.y};let t=0;for(;_<p*(w/2)&&t<x;)t++,_*=2,y.x*=2,y.y*=2;Math.max(_,p)/Math.min(_,p)<=w&&(_=p)}const v=[_],M=[{x:y.x,y:y.y}],b=Math.min(70.5310735,d)/w;for(;_>=b;)_/=2,y.x/=2,y.y/=2,v.push(_),M.push({x:y.x,y:y.y});return{projectedPixelSize:c,scales:v,srcResolutions:M,isCustomTilingScheme:!m}}},86301:(t,e,n)=>{n.d(e,{BH:()=>y,K:()=>C,KC:()=>g,NL:()=>h,QI:()=>x,Tg:()=>d,Yx:()=>u,nb:()=>I,wF:()=>D,xQ:()=>m});var i=n(71941),a=n(94452),s=n(52846),r=n(98115);const o=new Map;o.set("meter-per-second",1),o.set("kilometer-per-hour",.277778),o.set("knots",.514444),o.set("feet-per-second",.3048),o.set("mile-per-hour",.44704);const l=180/Math.PI,c=5,h=new i.X({esriMetersPerSecond:"meter-per-second",esriKilometersPerHour:"kilometer-per-hour",esriKnots:"knots",esriFeetPerSecond:"feet-per-second",esriMilesPerHour:"mile-per-hour"});function u(t,e){return o.get(t)/o.get(e)||1}function f(t){return(450-t)%360}function d(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"geographic";const[n,i]=t,a=Math.sqrt(n*n+i*i);let s=Math.atan2(i,n)*l;return s=(360+s)%360,"geographic"===e&&(s=f(s)),[a,s]}function p(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"geographic",n=t[1];"geographic"===e&&(n=f(n)),n%=360;const i=t[0];return[i*Math.cos(n/l),i*Math.sin(n/l)]}function m(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"geographic";if(!(0,r.nk)(t)||(0,a.Wi)(n))return t;const s="vector-magdir"===e?t.clone():(0,a.Wg)(g(t,e)),o=s.pixels[1];for(let a=0;a<o.length;a++)o[a]="geographic"===i?(o[a]+n[a]+270)%360:(o[a]+360-n[a])%360;return"vector-magdir"===e?s:g(s,"vector-magdir")}function g(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"geographic",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;if(!(0,r.nk)(t))return t;const{pixels:a,width:o,height:l}=t,c=o*l,h=a[0],u=a[1],f=t.pixelType.startsWith("f")?t.pixelType:"f32",m=s.Z.createEmptyBand(f,c),g=s.Z.createEmptyBand(f,c);let x=0;for(let s=0;s<l;s++)for(let t=0;t<o;t++)"vector-uv"===e?([m[x],g[x]]=d([h[x],u[x]],n),m[x]*=i):([m[x],g[x]]=p([h[x],u[x]],n),m[x]*=i,g[x]*=i),x++;const y=new s.Z({pixelType:f,width:t.width,height:t.height,mask:t.mask,validPixelCount:t.validPixelCount,maskIsAlpha:t.maskIsAlpha,pixels:[m,g]});return y.updateStatistics(),y}function x(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(1===n||!(0,r.nk)(t))return t;const i=t.clone(),{pixels:a,width:s,height:o}=i,l=a[0],c=a[1];let h=0;for(let r=0;r<o;r++)for(let t=0;t<s;t++)"vector-uv"===e?(l[h]*=n,c[h]*=n):l[h]*=n,h++;return i.updateStatistics(),i}function y(t,e,n,i,s){if((0,a.Wi)(s)||!s.spatialReference.equals(t.spatialReference))return{extent:t,width:Math.round(e/i),height:Math.round(n/i),resolution:t.width/e};const r=s.xmin,o=s.ymax,l=(t.xmax-t.xmin)/e*i,c=(t.ymax-t.ymin)/n*i,h=(l+c)/2;return t.xmin=r+Math.floor((t.xmin-r)/l)*l,t.xmax=r+Math.ceil((t.xmax-r)/l)*l,t.ymin=o+Math.floor((t.ymin-o)/c)*c,t.ymax=o+Math.ceil((t.ymax-o)/c)*c,{extent:t,width:Math.round(t.width/l),height:Math.round(t.height/c),resolution:h}}const _=w(0,0,0);function w(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Math.PI,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];i&&(n=(2*Math.PI-n)%(2*Math.PI));const a=i?-1:1,s=13*a,r=-7*a,o=-2*a,l=-16*a,c=21.75,[h,u]=M(0,e+s,n,c),[f,d]=M(t-5.5,e+r,n,c),[p,m]=M(t+5.5,e+r,n,c),[g,x]=M(t-1.5,e+o,n,c),[y,_]=M(t+1.5,e+o,n,c),[w,v]=M(t-1.5,e+l,n,c),[b,S]=M(t+1.5,e+l,n,c);return[h,u,f,d,g,x,y,_,p,m,w,v,b,S]}function v(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];n&&(e=(2*Math.PI-e)%(2*Math.PI));const i=n?-1:1,a=5*i,s=20*i,r=25*i,o=45,l=2*i,h=n?1:-1,u=5*h;let[f,d]=[0+u,0-s],[p,m]=[f+2*h,d],[g,x]=[p-0*h,m+l],[y,_]=[0-u,0-r],[w,v]=[y+0*h,_-l],b=Math.ceil(t/c),S=Math.floor(b/10);b-=8*S;const k=[],R=[];for(let c=0;c<b/2;c++,S--){S<=0&&b%2==1&&c===(b-1)/2&&(y=0,w=y+0*h,_=(_+d)/2,v=_-l);const[t,n]=M(y,_,e,o);if(S>0){const[i,a]=M(p,_,e,o),[s,r]=M(f,d,e,o);k.push(i),k.push(a),k.push(t),k.push(n),k.push(s),k.push(r)}else{const[i,a]=M(p,m,e,o),[s,r]=M(g,x,e,o),[l,c]=M(w,v,e,o);R.push(t),R.push(n),R.push(l),R.push(c),R.push(s),R.push(r),R.push(i),R.push(a)}_+=a,d+=a,m+=a,x+=a,v+=a}const[P,A]=M(0+u,0+s,e,o),C=7*h,[D,I]=M(0+C,0+s,e,o),[T,F]=M(0+u,0-r,e,o),[E,z]=M(0+C,0-r,e,o);return{pennants:k,barbs:R,shaft:[P,A,D,I,T,F,E,z]}}function M(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;const a=Math.sqrt(t*t+e*e)/i,s=(2*Math.PI+Math.atan2(e,t))%(2*Math.PI);return[a,(2*Math.PI+s-n)%(2*Math.PI)]}const b=[0,1,3,6,10,16,21,27,33,40,47,55,63],S=[0,.5,1,1.5,2],k=[0,.25,.5,1,1.5,2,2.5,3,3.5,4];function R(t,e,n,i){const a=u(i||"knots",n);let s;for(s=1;s<e.length;s++)if(s===e.length-1){if(t<e[s]*a)break}else if(t<=e[s]*a)break;return Math.min(s-1,e.length-2)}function P(t,e,n,i,a){let s=0;switch(e){case"beaufort_kn":s=R(t,b,"knots",n);break;case"beaufort_km":s=R(t,b,"kilometer-per-hour",n);break;case"beaufort_ft":s=R(t,b,"feet-per-second",n);break;case"beaufort_m":s=R(t,b,"meter-per-second",n);break;case"classified_arrow":s=R(t,null!==a&&void 0!==a?a:[],i,n);break;case"ocean_current_m":s=R(t,S,"meter-per-second",n);break;case"ocean_current_kn":s=R(t,k,"knots",n)}return s}const A=[];function C(t,e){let n=0,i=0;const{width:a,height:s,mask:r}=t,o=t.pixels[0],l=[],f=[],d=u(h.fromJSON(e.inputUnit),"knots"),p="wind_speed"===e.style?c:Number.MAX_VALUE;for(let c=0;c<s;c++)for(let t=0;t<a;t++){const e=o[c*a+t]*d;if((!r||r[c*a+t])&&e<p){for(let i=0;i<4;i++)l[n++]=(t+.5)/a,l[n++]=(c+.5)/s,l[n++]=i<2?-.5:.5,l[n++]=i%2==0?-.5:.5,l[n++]=0,l[n++]=e;const r=4*(n/24-1);f[i++]=r,f[i++]=r+1,f[i++]=r+2,f[i++]=r+1,f[i++]=r+2,f[i++]=r+3}}return{vertexData:new Float32Array(l),indexData:new Uint32Array(f)}}function D(t,e){return"simple_scalar"===e.style?C(t,e):"wind_speed"===e.style?function(t,e){if(0===A.length)for(let c=0;c<30;c++)A.push(v(5*c,0,!e.invertDirection));const n=u(h.fromJSON(e.inputUnit),"knots"),{width:i,height:a,mask:s}=t,r=t.pixels[0],o=t.pixels[1],l=[],f=[];let d=0,p=0;for(let h=0;h<a;h++)for(let t=0;t<i;t++){const e=h*i+t,u=r[e]*n;if((!s||s[h*i+t])&&u>=c){const n=(o[e]+360)%360/180*Math.PI,{pennants:s,barbs:r,shaft:c}=A[Math.min(Math.floor(u/5),29)];if(s.length+r.length===0)continue;let m=l.length/6;const g=(t+.5)/i,x=(h+.5)/a;for(let t=0;t<s.length;t+=2)l[d++]=g,l[d++]=x,l[d++]=s[t],l[d++]=s[t+1]+n,l[d++]=0,l[d++]=u;for(let t=0;t<r.length;t+=2)l[d++]=g,l[d++]=x,l[d++]=r[t],l[d++]=r[t+1]+n,l[d++]=0,l[d++]=u;for(let t=0;t<c.length;t+=2)l[d++]=g,l[d++]=x,l[d++]=c[t],l[d++]=c[t+1]+n,l[d++]=0,l[d++]=u;for(let t=0;t<s.length/6;t++)f[p++]=m,f[p++]=m+1,f[p++]=m+2,m+=3;for(let t=0;t<r.length/8;t++)f[p++]=m,f[p++]=m+1,f[p++]=m+2,f[p++]=m+1,f[p++]=m+2,f[p++]=m+3,m+=4;f[p++]=m+0,f[p++]=m+1,f[p++]=m+2,f[p++]=m+1,f[p++]=m+3,f[p++]=m+2,m+=4}}return{vertexData:new Float32Array(l),indexData:new Uint32Array(f)}}(t,e):function(t,e){const{style:n,inputUnit:i,outputUnit:s,breakValues:r}=e,o=h.fromJSON(i),l=h.fromJSON(s);let c=0,u=0;const{width:f,height:d,mask:p}=t,m=t.pixels[0],g=t.pixels[1],x=(0,a.pC)(p)?p.filter((t=>t>0)).length:f*d,y=new Float32Array(42*x),v=new Uint32Array(15*x),M=e.invertDirection?w(0,0,0,!1):_;for(let a=0;a<d;a++)for(let t=0;t<f;t++){const e=a*f+t;if(!p||p[a*f+t]){const i=(g[e]+360)%360/180*Math.PI,s=P(m[e],n,o,l,r);for(let n=0;n<M.length;n+=2)y[c++]=(t+.5)/f,y[c++]=(a+.5)/d,y[c++]=M[n],y[c++]=M[n+1]+i,y[c++]=s,y[c++]=m[e];const h=7*(c/42-1);v[u++]=h,v[u++]=h+1,v[u++]=h+2,v[u++]=h+0,v[u++]=h+4,v[u++]=h+3,v[u++]=h+0,v[u++]=h+2,v[u++]=h+3,v[u++]=h+2,v[u++]=h+5,v[u++]=h+3,v[u++]=h+5,v[u++]=h+6,v[u++]=h+3}}return{vertexData:y,indexData:v}}(t,e)}function I(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[0,0],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5;const{width:r,height:o,mask:l}=t,[c,h]=t.pixels,[u,f]=i,m=Math.round((r-u)/n),g=Math.round((o-f)/n),x=m*g,y=new Float32Array(x),_=new Float32Array(x),w=new Uint8Array(x),v="vector-uv"===e;for(let s=0;s<g;s++)for(let t=0;t<m;t++){let e=0;const i=s*m+t,g=Math.max(0,s*n+f),x=Math.max(0,t*n+u),M=Math.min(o,g+n),b=Math.min(r,x+n);for(let t=g;t<M;t++)for(let n=x;n<b;n++){const a=t*r+n;if(!l||l[a]){e++;const t=v?[c[a],h[a]]:[c[a],(360+h[a])%360],[n,s]=v?t:p(t);y[i]+=n,_[i]+=s}}if(e>=(M-g)*(b-x)*(1-a)){w[i]=1;const[t,n]=d([y[i]/e,_[i]/e]);y[i]=t,_[i]=n}else w[i]=0,y[i]=0,_[i]=0}const M=new s.Z({width:m,height:g,pixels:[y,_],mask:w});return M.updateStatistics(),M}},29693:(t,e,n)=>{n.d(e,{Z:()=>dt});var i=n(78808),a=n(14441),s=n(99379),r=n(51654),o=n(90754),l=(n(83194),n(75476),n(90825)),c=n(94452),h=n(3117);function u(t){return"constant"===t.kind?t.value[0]:t.values[t.values.length-1]}function f(t){const e=t.toRgba();return[e[0]/255,e[1]/255,e[2]/255,e[3]]}function d(t){if(!t.hasVisualVariables("size"))return{kind:"constant",value:[(0,h.F2)(t.trailWidth)]};const e=t.getVisualVariablesForType("size")[0],n=[],i=[];let a;if(e.stops){for(const t of e.stops)n.push(t.value),i.push((0,h.F2)(t.size));a=e.stops.length}else n.push(e.minDataValue,e.maxDataValue),i.push((0,h.F2)(e.minSize),(0,h.F2)(e.maxSize)),a=2;return{kind:"ramp",stops:n,values:i,count:a}}function p(t){if(!t.hasVisualVariables("opacity"))return{kind:"constant",value:[1]};const e=t.getVisualVariablesForType("opacity")[0],n=[],i=[];for(const a of e.stops)n.push(a.value),i.push(a.opacity);return{kind:"ramp",stops:n,values:i,count:e.stops.length}}function m(t,e,n,i){switch(e){case"int":t.setUniform1iv(n,i);break;case"float":t.setUniform1fv(n,i);break;case"vec2":t.setUniform2fv(n,i);break;case"vec3":t.setUniform3fv(n,i);break;case"vec4":t.setUniform4fv(n,i)}}function g(t,e,n,i){"constant"===i.kind?m(t,n,"u_".concat(e),i.value):(m(t,"float","u_".concat(e,"_stops"),i.stops),m(t,n,"u_".concat(e,"_values"),i.values),t.setUniform1i("u_".concat(e,"_count"),i.count))}function x(t,e){return t===e||!(!(0,c.pC)(t)||!(0,c.pC)(e))&&t.equals(e)}function y(t,e){if(!function(t,e){let n=!0;return n=n&&t.collisions===e.collisions,n=n&&t.density===e.density,n=n&&t.interpolate===e.interpolate,n=n&&t.lineCollisionWidth===e.lineCollisionWidth,n=n&&t.lineSpacing===e.lineSpacing,n=n&&t.maxTurnAngle===e.maxTurnAngle,n=n&&t.minSpeedThreshold===e.minSpeedThreshold,n=n&&t.segmentLength===e.segmentLength,n=n&&t.smoothing===e.smoothing,n=n&&t.velocityScale===e.velocityScale,n=n&&t.verticesPerLine===e.verticesPerLine,n}(t.simulationSettings,e.simulationSettings))return!1;if(!x(t.timeExtent,e.timeExtent))return!1;let n=!0;return n=n&&t.loadImagery===e.loadImagery,n=n&&t.createFlowMesh===e.createFlowMesh,n=n&&t.color.kind===e.color.kind,n=n&&t.opacity.kind===e.opacity.kind,n=n&&t.size.kind===e.size.kind,n}var _=n(3341),w=n(65065),v=n(55261),M=n(98552),b=n(35371),S=n(49205);class k{constructor(t){this._params=t,this.animated=!1}isCompatible(t){if(!(t instanceof k))return!1;if(!x(this._params.timeExtent,t._params.timeExtent))return!1;let e=!0;return e=e&&this._params.loadImagery===t._params.loadImagery,e=e&&this._params.color.kind===t._params.color.kind,e=e&&this._params.opacity.kind===t._params.opacity.kind,e}async load(t,e){const{extent:n,size:i}=t;(0,_.k_)(e);const a=await this._params.loadImagery(n,i[0],i[1],this._params.timeExtent,e);return new C(a,{color:this._params.color,opacity:this._params.opacity})}render(t,e,n){const{context:i}=t,{program:a}=n;i.setFaceCullingEnabled(!1),i.setBlendingEnabled(!0),i.setBlendFunction(v.zi.ONE,v.zi.ONE_MINUS_SRC_ALPHA),i.useProgram(a),a.setUniformMatrix3fv("u_dvsMat3",e.dvsMat3),i.bindTexture(n.texture,0),a.setUniform1i("u_texture",0),a.setUniform1f("u_Min",n.min),a.setUniform1f("u_Max",n.max),g(a,"color","vec4",this._params.color),g(a,"opacity","float",this._params.opacity),i.bindVAO(n.vertexArray),i.drawArrays(v.MX.TRIANGLE_STRIP,0,4)}}const R=new Map;R.set("a_position",0),R.set("a_texcoord",1);const P={geometry:[new S.G("a_position",2,v.g.UNSIGNED_SHORT,0,8),new S.G("a_texcoord",2,v.g.UNSIGNED_SHORT,4,8)]},A={vsPath:"raster/flow/imagery",fsPath:"raster/flow/imagery",attributes:R};class C{constructor(t,e){this._flowData=t,this._values=e}attach(t){const{context:e}=t,{width:n,height:i}=this._flowData,a=w.f.createVertex(e,v.l1.STATIC_DRAW,new Uint16Array([0,0,0,1,n,0,1,1,0,i,0,0,n,i,1,0])),s=new b.U(e,R,P,{geometry:a}),r=[];"ramp"===this._values.color.kind&&r.push("vvColor"),"ramp"===this._values.opacity.kind&&r.push("vvOpacity");const o=t.painter.materialManager.getProgram(A,r);let l=1e6,c=-1e6;for(let f=0;f<i;f++)for(let t=0;t<n;t++)if(0!==this._flowData.mask[f*n+t]){const e=this._flowData.data[2*(f*n+t)+0],i=this._flowData.data[2*(f*n+t)+1],a=Math.sqrt(e*e+i*i);l=Math.min(l,a),c=Math.max(c,a)}const h=new Uint8Array(4*n*i);for(let f=0;f<i;f++)for(let t=0;t<n;t++)if(0!==this._flowData.mask[f*n+t]){const e=this._flowData.data[2*(f*n+t)+0],i=this._flowData.data[2*(f*n+t)+1],a=(Math.sqrt(e*e+i*i)-l)/(c-l);h[4*(f*n+t)+0]=255*a,h[4*(f*n+t)+1]=0,h[4*(f*n+t)+2]=0,h[4*(f*n+t)+3]=255}else h[4*(f*n+t)+0]=0,h[4*(f*n+t)+1]=0,h[4*(f*n+t)+2]=0,h[4*(f*n+t)+3]=0;const u=new M.x(e,{pixelFormat:v.VI.RGBA,internalFormat:v.VI.RGBA,samplingMode:v.cw.LINEAR,dataType:v.Br.UNSIGNED_BYTE,wrapMode:v.e8.CLAMP_TO_EDGE,flipped:!0,width:n,height:i},h);this.vertexArray=s,this.program=o,this.texture=u,this.min=l,this.max=c,this._flowData=null}detach(){this.vertexArray.dispose(),this.texture.dispose()}get ready(){return this.program.isCompiled}}class D{constructor(t){this._params=t}get animated(){return this._params.flowSpeed>0}isCompatible(t){return t instanceof D&&y(this._params,t._params)}async load(t,e){const{extent:n,size:i}=t;(0,_.k_)(e);const a=await this._params.loadImagery(n,i[0],i[1],this._params.timeExtent,e),{vertexData:s,indexData:r}=await this._params.createFlowMesh("Particles",this._params.simulationSettings,a,e);return new E(s,r,{color:this._params.color,opacity:this._params.opacity,size:this._params.size})}render(t,e,n){const{context:i}=t,{program:a}=n;i.setFaceCullingEnabled(!1),i.setBlendingEnabled(!0),i.setBlendFunction(v.zi.ONE,v.zi.ONE_MINUS_SRC_ALPHA),i.useProgram(a),a.setUniform1f("u_time",e.time),a.setUniform1f("u_trailLength",this._params.trailLength),a.setUniform1f("u_flowSpeed",this._params.flowSpeed),a.setUniform1f("u_featheringSize",this._params.featheringSize),a.setUniform1f("u_featheringOffset",this._params.featheringOffset),a.setUniform1f("u_introFade",this._params.introFade?1:0),a.setUniform1f("u_fadeToZero",this._params.fadeToZero?1:0),a.setUniform1f("u_decayRate",this._params.decayRate),a.setUniformMatrix3fv("u_dvsMat3",e.dvsMat3),a.setUniformMatrix3fv("u_displayViewMat3",e.displayViewMat3),g(a,"color","vec4",this._params.color),g(a,"opacity","float",this._params.opacity),g(a,"size","float",this._params.size),i.bindVAO(n.vertexArray),i.drawElements(v.MX.TRIANGLES,n.indexCount,v.g.UNSIGNED_INT,0)}}const I=new Map;I.set("a_xyts0",0),I.set("a_xyts1",1),I.set("a_typeIdDurationSeed",2),I.set("a_extrudeInfo",3);const T={geometry:[new S.G("a_xyts0",4,v.g.FLOAT,0,64),new S.G("a_xyts1",4,v.g.FLOAT,16,64),new S.G("a_typeIdDurationSeed",4,v.g.FLOAT,32,64),new S.G("a_extrudeInfo",4,v.g.FLOAT,48,64)]},F={vsPath:"raster/flow/particles",fsPath:"raster/flow/particles",attributes:I};class E{constructor(t,e,n){this._vertexData=t,this._indexData=e,this._values=n}attach(t){const{context:e}=t,n=w.f.createVertex(e,v.l1.STATIC_DRAW,this._vertexData),i=w.f.createIndex(e,v.l1.STATIC_DRAW,this._indexData),a=new b.U(e,I,T,{geometry:n},i),s=[];"ramp"===this._values.color.kind&&s.push("vvColor"),"ramp"===this._values.opacity.kind&&s.push("vvOpacity"),"ramp"===this._values.size.kind&&s.push("vvSize");const r=t.painter.materialManager.getProgram(F,s);this.vertexArray=a,this.program=r,this.indexCount=this._indexData.length,this._vertexData=null,this._indexData=null}detach(){this.vertexArray.dispose()}get ready(){return this.program.isCompiled}}class z{constructor(t){this._styles=t}get animated(){return this._styles.reduce(((t,e)=>t||e.animated),!1)}isCompatible(t){if(!(t instanceof z))return!1;if(this._styles.length!==t._styles.length)return!1;const e=this._styles.length;for(let n=0;n<e;n++)if(!this._styles[n].isCompatible(t._styles[n]))return!1;return!0}async load(t,e){const n=await Promise.all(this._styles.map((n=>n.load(t,e))));return new V(n)}render(t,e,n){for(let i=0;i<this._styles.length;i++)this._styles[i].render(t,e,n.resources[i])}}class V{constructor(t){this.resources=t}attach(t){for(const e of this.resources)e.attach(t)}detach(){for(const t of this.resources)t.detach()}get ready(){return this.resources.reduce(((t,e)=>t&&e.ready),!0)}}class O{constructor(t){this._params=t}get animated(){return this._params.flowSpeed>0}isCompatible(t){return t instanceof O&&y(this._params,t._params)}async load(t,e){const{extent:n,size:i}=t;(0,_.k_)(e);const a=await this._params.loadImagery(n,i[0],i[1],this._params.timeExtent,e),{vertexData:s,indexData:r}=await this._params.createFlowMesh("Streamlines",this._params.simulationSettings,a,e);return new G(s,r,{color:this._params.color,opacity:this._params.opacity,size:this._params.size})}render(t,e,n){const{context:i}=t,{program:a}=n;i.setFaceCullingEnabled(!1),i.setBlendingEnabled(!0),i.setBlendFunction(v.zi.ONE,v.zi.ONE_MINUS_SRC_ALPHA),i.useProgram(a),a.setUniform1f("u_time",e.time),a.setUniform1f("u_trailLength",this._params.trailLength),a.setUniform1f("u_flowSpeed",this._params.flowSpeed),a.setUniform1f("u_featheringSize",this._params.featheringSize),a.setUniform1f("u_featheringOffset",this._params.featheringOffset),a.setUniform1f("u_introFade",this._params.introFade?1:0),a.setUniform1f("u_fadeToZero",this._params.fadeToZero?1:0),a.setUniform1f("u_decayRate",this._params.decayRate),a.setUniformMatrix3fv("u_dvsMat3",e.dvsMat3),a.setUniformMatrix3fv("u_displayViewMat3",e.displayViewMat3),g(a,"color","vec4",this._params.color),g(a,"opacity","float",this._params.opacity),g(a,"size","float",this._params.size),i.bindVAO(n.vertexArray),i.drawElements(v.MX.TRIANGLES,n.indexCount,v.g.UNSIGNED_INT,0)}}const N=new Map;N.set("a_positionAndSide",0),N.set("a_timeInfo",1),N.set("a_extrude",2),N.set("a_speed",3);const U={geometry:[new S.G("a_positionAndSide",3,v.g.FLOAT,0,36),new S.G("a_timeInfo",3,v.g.FLOAT,12,36),new S.G("a_extrude",2,v.g.FLOAT,24,36),new S.G("a_speed",1,v.g.FLOAT,32,36)]},L={vsPath:"raster/flow/streamlines",fsPath:"raster/flow/streamlines",attributes:N};class G{constructor(t,e,n){this._vertexData=t,this._indexData=e,this._values=n}attach(t){const{context:e}=t,n=w.f.createVertex(e,v.l1.STATIC_DRAW,this._vertexData),i=w.f.createIndex(e,v.l1.STATIC_DRAW,this._indexData),a=new b.U(e,N,U,{geometry:n},i),s=[];"ramp"===this._values.color.kind&&s.push("vvColor"),"ramp"===this._values.opacity.kind&&s.push("vvOpacity"),"ramp"===this._values.size.kind&&s.push("vvSize");const r=t.painter.materialManager.getProgram(L,s);this.vertexArray=a,this.program=r,this.indexCount=this._indexData.length,this._vertexData=null,this._indexData=null}detach(){this.vertexArray.dispose()}get ready(){return this.program.isCompiled}}const Z=4,W=1,q=.5,B=!0,j=!0,K=2.3;function Y(t,e){const{flowSpeed:n,trailLength:i}=t,a=function(t){const e=u(d(t)),n=e,i=Math.max(e/2,5),a=Math.round((0,h.F2)(t.maxPathLength)/i)+1,{density:s}=t;return{smoothing:(0,h.F2)(t.smoothing),interpolate:!0,velocityScale:"flow-from"===t.flowRepresentation?1:-1,verticesPerLine:a,minSpeedThreshold:.001,segmentLength:i,maxTurnAngle:1,collisions:!0,lineCollisionWidth:n,lineSpacing:10,density:s}}(t);let s=null;const r={opacity:p(t),size:d(t)};let o=function(t){if(!t.hasVisualVariables("color"))return{kind:"constant",value:f(t.color)};const e=t.getVisualVariablesForType("color")[0],n=[],i=[];for(const a of e.stops)n.push(a.value),Array.prototype.push.apply(i,f(a.color));return{kind:"ramp",stops:n,values:i,count:e.stops.length}}(t);if("none"===t.background)r.color=o;else{"constant"===o.kind&&(o={kind:"ramp",stops:[0,1],values:[0,0,0,1,o.value[0],o.value[1],o.value[2],o.value[3]],count:2});const t={loadImagery:e.loadImagery,timeExtent:e.timeExtent,color:o,opacity:{kind:"constant",value:[1]}};s=new k(t),r.color={kind:"constant",value:[.1,.1,.1,1]}}const l={loadImagery:e.loadImagery,createFlowMesh:e.createFlowMesh,simulationSettings:a,timeExtent:e.timeExtent,trailLength:i,flowSpeed:n,featheringSize:W,featheringOffset:q,introFade:B,fadeToZero:j,decayRate:K,color:r.color,opacity:r.opacity,size:r.size},m="butt"===t.trailCap||u(d(t))<=Z?new O(l):new D(l);return(0,c.pC)(s)?new z([s,m]):m}var J=n(28738),H=n(96410),X=n(51116),Q=n(48925);class $ extends Q.Z{constructor(){super(...arguments),this.flowStyle=null}get requiresDedicatedFBO(){return!1}doRender(t){super.doRender(t)}prepareRenderPasses(t){const e=t.registerRenderPass({name:"flow",brushes:[H.Z],target:()=>this.children,drawPhase:X.jx.MAP});return[...super.prepareRenderPasses(t),e]}}n(75254);var tt=n(18891),et=n(92249),nt=n(78974),it=n(42836);class at{constructor(t,e,n,i){this.state={name:"created"},this.flowStyle=t,this.extent=e,this.size=n,this.pixelRatio=i}async load(){const t=new AbortController;this.state={name:"loading",abortController:t};const e={extent:this.extent,size:this.size,pixelRatio:this.pixelRatio},n=await this.flowStyle.load(e,t.signal);this.state={name:"loaded",resources:n}}attach(t){if("loaded"!==this.state.name)return void et.Z.getLogger("esri.views.2d.engine.flow.FlowDisplayData").error("Only loaded resources can be attached.");const e=this.state.resources;e.attach(t),this.state={name:"attached",resources:e}}detach(){if("loading"===this.state.name)return this.state.abortController.abort(),void(this.state={name:"detached"});"attached"===this.state.name&&(this.state.resources.detach(),this.state={name:"detached"})}update(t){return!!this.flowStyle.isCompatible(t.flowStyle)&&(!(!this.extent.equals(t.extent)||this.size[0]!==t.size[0]||this.size[1]!==t.size[1]||this.pixelRatio!==t.pixelRatio)&&(this.flowStyle=t.flowStyle,!0))}}var st=n(46541),rt=n(78819),ot=n(49399);class lt extends ot.s{constructor(){super(...arguments),this._displayData=null}get displayData(){return this._displayData}set displayData(t){this._displayData=t,this.requestRender()}clear(){(0,c.pC)(this._displayData)&&(this._displayData.detach(),this._displayData=null,this.requestRender())}setTransform(t){const{displayData:e}=this;if((0,c.Wi)(e))return;const n=e.extent.xmin,i=e.extent.ymax,a=[0,0];t.toScreen(a,[n,i]);const s=(e.extent.xmax-e.extent.xmin)/e.size[0]/t.resolution,r=(0,nt.Vl)(t.rotation),{dvs:o}=this.transforms;(0,st.j)(o,[-1,1,0]),(0,st.d)(o,o,[2/(t.size[0]*t.pixelRatio),-2/(t.size[1]*t.pixelRatio),1]),(0,st.h)(o,o,[a[0],a[1],0]),(0,st.r)(o,o,r),(0,st.d)(o,o,[s*t.pixelRatio,s*t.pixelRatio,1])}_createTransforms(){return{dvs:(0,rt.c)()}}}var ct=n(37299);let ht=class extends tt.Z{constructor(t){super(t),this._flowDisplayObject=new lt,this._loading=null}initialize(){this.flowContainer.addChild(this._flowDisplayObject)}destroy(){this._clear(),this.flowContainer.removeAllChildren()}get updating(){return null!=this._loading}update(t){const{flowStyle:e}=this.flowContainer;if((0,c.Wi)(e))return void this._clear();const{extent:n,rotation:i,resolution:a,pixelRatio:s}=t.state,r=function(t,e){const n=new it.Z({x:(t.xmax+t.xmin)/2,y:(t.ymax+t.ymin)/2,spatialReference:t.spatialReference}),i=t.xmax-t.xmin,a=t.ymax-t.ymin,s=Math.abs(Math.cos((0,nt.Vl)(e))),r=Math.abs(Math.sin((0,nt.Vl)(e))),o=s*i+r*a,l=r*i+s*a,c=new ct.Z({xmin:n.x-o/2,ymin:n.y-l/2,xmax:n.x+o/2,ymax:n.y+l/2,spatialReference:t.spatialReference});return c.centerAt(n),c}(n,i);r.expand(1.15);const o=[Math.round((r.xmax-r.xmin)/a),Math.round((r.ymax-r.ymin)/a)],l=new at(e,r,o,s);if((0,c.pC)(this._loading)){if(this._loading.update(l))return;this._loading.detach(),this._loading=null}!(0,c.Wi)(this._flowDisplayObject.displayData)&&this._flowDisplayObject.displayData.update(l)||(l.load().then((()=>{this._flowDisplayObject.clear(),this._flowDisplayObject.displayData=this._loading,this._loading=null}),(t=>{(0,_.D_)(t)||(et.Z.getLogger(this.declaredClass).error("A resource failed to load.",t),this._loading=null)})),this._loading=l)}_clear(){this._flowDisplayObject.clear(),(0,c.pC)(this._loading)&&(this._loading.detach(),this._loading=null)}};(0,i._)([(0,o.Cb)()],ht.prototype,"_loading",void 0),(0,i._)([(0,o.Cb)()],ht.prototype,"flowContainer",void 0),(0,i._)([(0,o.Cb)()],ht.prototype,"updating",null),ht=(0,i._)([(0,l.j)("esri.views.2d.engine.flow.FlowStrategy")],ht);const ut=ht;let ft=class extends s.r{constructor(){super(...arguments),this._loadImagery=(t,e,n,i,a)=>(0,J.KK)(this.layer,t,e,n,i,a),this._createFlowMesh=(t,e,n,i)=>this.layer.createFlowMesh({meshType:t,flowData:n,simulationSettings:e},{signal:i}),this.attached=!1,this.container=null,this.layer=null,this.type="flow",this.timeExtent=null,this.redrawOrRefetch=async()=>{this._updateVisualization()}}get updating(){return!this._strategy||this._strategy.updating}attach(){const{layer:t}=this,e=()=>{this._loadImagery=(e,n,i,a,s)=>(0,J.KK)(t,e,n,i,a,s),this._updateVisualization()};"multidimensionalDefinition"in t?this.handles.add((0,r.YP)((()=>t.multidimensionalDefinition),e)):this.handles.add([(0,r.YP)((()=>t.mosaicRule),e),(0,r.YP)((()=>t.renderingRule),e),(0,r.YP)((()=>t.definitionExpression),e)]),this.container=new $,this._strategy=new ut({flowContainer:this.container}),this._updateVisualization()}detach(){this._strategy.destroy(),this.container.removeAllChildren(),this.container=null,this.handles.removeAll()}update(t){t.stationary?this._strategy.update(t):this.layerView.requestUpdate()}hitTest(t){return new a.Z({attributes:{},geometry:t.clone(),layer:this.layer})}moveEnd(){}async doRefresh(){}_updateVisualization(){const{renderer:t}=this.layer;if("flow"!==t.type)return;const e=Y(t,{loadImagery:this._loadImagery,createFlowMesh:this._createFlowMesh,timeExtent:this.timeExtent});this.container.flowStyle=e,this.layerView.requestUpdate()}};(0,i._)([(0,o.Cb)()],ft.prototype,"_strategy",void 0),(0,i._)([(0,o.Cb)()],ft.prototype,"attached",void 0),(0,i._)([(0,o.Cb)()],ft.prototype,"container",void 0),(0,i._)([(0,o.Cb)()],ft.prototype,"layer",void 0),(0,i._)([(0,o.Cb)()],ft.prototype,"layerView",void 0),(0,i._)([(0,o.Cb)()],ft.prototype,"type",void 0),(0,i._)([(0,o.Cb)()],ft.prototype,"updating",null),(0,i._)([(0,o.Cb)()],ft.prototype,"timeExtent",void 0),ft=(0,i._)([(0,l.j)("esri.views.2d.engine.flow.FlowView2D")],ft);const dt=ft},28738:(t,e,n)=>{n.d(e,{GE:()=>d,KK:()=>y});n(75254);var i=n(34276),a=n(92249),s=n(78974),r=n(94452),o=n(3341),l=n(79738),c=n(95985),h=n(37299);const u=a.Z.getLogger("esri.views.2d.engine.flow.dataUtils"),f=10;async function d(t,e,n,a){const s=performance.now(),r=p(e,n),c=performance.now(),h=g(e,r,n.width,n.height),d=performance.now(),m=function(t,e){const n=new l.Z,i=t.reduce(((t,e)=>t+e.length),0),a=new Float32Array(4*i),s=new Array(t.length);let r=0,o=0;for(const l of t){const t=r;for(const e of l)a[4*r+0]=e.x,a[4*r+1]=e.y,a[4*r+2]=e.t,a[4*r+3]=e.speed,r++;s[o++]={startVertex:t,numberOfVertices:l.length,totalTime:l[l.length-1].t,timeSeed:e?n.getFloat():0}}return{lineVertices:a,lineDescriptors:s}}(h,!0),x=performance.now(),y="Streamlines"===t?function(t,e){const n=9,{lineVertices:i,lineDescriptors:a}=t;let s=0,r=0;for(const d of a)s+=2*d.numberOfVertices,r+=6*(d.numberOfVertices-1);const o=new Float32Array(s*n),l=new Uint32Array(r);let c=0,h=0;function u(){l[h++]=c-2,l[h++]=c,l[h++]=c-1,l[h++]=c,l[h++]=c+1,l[h++]=c-1}function f(t,e,i,a,s,r,l,h){const u=c*n;let f=0;o[u+f++]=t,o[u+f++]=e,o[u+f++]=1,o[u+f++]=i,o[u+f++]=r,o[u+f++]=l,o[u+f++]=a/2,o[u+f++]=s/2,o[u+f++]=h,c++,o[u+f++]=t,o[u+f++]=e,o[u+f++]=-1,o[u+f++]=i,o[u+f++]=r,o[u+f++]=l,o[u+f++]=-a/2,o[u+f++]=-s/2,o[u+f++]=h,c++}for(const d of a){const{totalTime:t,timeSeed:n}=d;let a=null,s=null,r=null,o=null,l=null,c=null;for(let h=0;h<d.numberOfVertices;h++){const p=i[4*(d.startVertex+h)+0],m=i[4*(d.startVertex+h)+1],g=i[4*(d.startVertex+h)+2],x=i[4*(d.startVertex+h)+3];let y=null,_=null,w=null,v=null;if(h>0){y=p-a,_=m-s;const i=Math.sqrt(y*y+_*_);if(y/=i,_/=i,h>1){let t=y+l,n=_+c;const i=Math.sqrt(t*t+n*n);t/=i,n/=i;const a=Math.min(1/(t*y+n*_),e);t*=a,n*=a,w=-n,v=t}else w=-_,v=y;null!==w&&null!==v&&(f(a,s,r,w,v,t,n,x),u())}a=p,s=m,r=g,l=y,c=_,o=x}f(a,s,r,-c,l,t,n,o)}return{vertexData:o,indexData:l}}(m,f):function(t){const e=16,n=1,i=2,{lineVertices:a,lineDescriptors:s}=t;let r=0,o=0;for(const I of s){const t=I.numberOfVertices-1;r+=4*t*2,o+=6*t*2}const l=new Float32Array(r*e),c=new Uint32Array(o);let h,u,f,d,p,m,g,x,y,_,w,v,M,b,S=0,k=0;function R(){c[k++]=S-8,c[k++]=S-7,c[k++]=S-6,c[k++]=S-7,c[k++]=S-5,c[k++]=S-6,c[k++]=S-4,c[k++]=S-3,c[k++]=S-2,c[k++]=S-3,c[k++]=S-1,c[k++]=S-2}function P(t,a,s,r,o,c,h,u,f,d,p,m,g,x){const y=S*e;let _=0;for(const e of[n,i])for(const n of[1,2,3,4])l[y+_++]=t,l[y+_++]=a,l[y+_++]=s,l[y+_++]=r,l[y+_++]=h,l[y+_++]=u,l[y+_++]=f,l[y+_++]=d,l[y+_++]=e,l[y+_++]=n,l[y+_++]=g,l[y+_++]=x,l[y+_++]=o/2,l[y+_++]=c/2,l[y+_++]=p/2,l[y+_++]=m/2,S++}function A(t,e){let n=y+w,i=_+v;const a=Math.sqrt(n*n+i*i);n/=a,i/=a;const s=y*n+_*i;n/=s,i/=s;let r=w+M,o=v+b;const l=Math.sqrt(r*r+o*o);r/=l,o/=l;const c=w*r+v*o;r/=c,o/=c,P(h,u,f,d,-i,n,p,m,g,x,-o,r,t,e),R()}function C(t,e,n,i,a,s){if(y=w,_=v,w=M,v=b,null==y&&null==_&&(y=w,_=v),null!=p&&null!=m){M=t-p,b=e-m;const n=Math.sqrt(M*M+b*b);M/=n,b/=n}null!=y&&null!=_&&A(a,s),h=p,u=m,f=g,d=x,p=t,m=e,g=n,x=i}function D(t,e){y=w,_=v,w=M,v=b,null==y&&null==_&&(y=w,_=v),null!=y&&null!=_&&A(t,e)}for(const I of s){h=null,u=null,f=null,d=null,p=null,m=null,g=null,x=null,y=null,_=null,w=null,v=null,M=null,b=null;const{totalTime:t,timeSeed:e}=I;for(let n=0;n<I.numberOfVertices;n++)C(a[4*(I.startVertex+n)+0],a[4*(I.startVertex+n)+1],a[4*(I.startVertex+n)+2],a[4*(I.startVertex+n)+3],t,e);D(t,e)}return{vertexData:l,indexData:c}}(m),_=performance.now();return(0,i.Z)("esri-2d-profiler")&&(u.info("I.1","_createFlowFieldFromData (ms)",Math.round(c-s)),u.info("I.2","_getStreamlines (ms)",Math.round(d-c)),u.info("I.3","createAnimatedLinesData (ms)",Math.round(x-d)),u.info("I.4","create{Streamlines|Particles}Mesh (ms)",Math.round(_-x)),u.info("I.5","createFlowMesh (ms)",Math.round(_-s)),u.info("I.6","Mesh size (bytes)",y.vertexData.buffer.byteLength+y.indexData.buffer.byteLength)),await Promise.resolve(),(0,o.k_)(a),y}function p(t,e){const n=function(t,e,n,i){if(0===i)return t;const a=Math.round(3*i),s=new Array(2*a+1);let r=0;for(let c=-a;c<=a;c++){const t=Math.exp(-c*c/(i*i));s[c+a]=t,r+=t}for(let c=-a;c<=a;c++)s[c+a]/=r;const o=new Float32Array(t.length);for(let c=0;c<n;c++)for(let n=0;n<e;n++){let i=0,r=0;for(let o=-a;o<=a;o++){if(n+o<0||n+o>=e)continue;const l=s[o+a];i+=l*t[2*(c*e+(n+o))+0],r+=l*t[2*(c*e+(n+o))+1]}o[2*(c*e+n)+0]=i,o[2*(c*e+n)+1]=r}const l=new Float32Array(t.length);for(let c=0;c<e;c++)for(let t=0;t<n;t++){let i=0,r=0;for(let l=-a;l<=a;l++){if(t+l<0||t+l>=n)continue;const h=s[l+a];i+=h*o[2*((t+l)*e+c)+0],r+=h*o[2*((t+l)*e+c)+1]}l[2*(t*e+c)+0]=i,l[2*(t*e+c)+1]=r}return l}(e.data,e.width,e.height,t.smoothing);return t.interpolate?(t,i)=>{const a=Math.floor(t),s=Math.floor(i);if(a<0||a>=e.width)return[0,0];if(s<0||s>=e.height)return[0,0];const r=t-a,o=i-s,l=a,c=s,h=a<e.width-1?a+1:a,u=s<e.height-1?s+1:s,f=n[2*(c*e.width+l)],d=n[2*(c*e.width+h)],p=n[2*(u*e.width+l)],m=n[2*(u*e.width+h)],g=n[2*(c*e.width+l)+1],x=n[2*(c*e.width+h)+1];return[(f*(1-o)+p*o)*(1-r)+(d*(1-o)+m*o)*r,(g*(1-o)+n[2*(u*e.width+l)+1]*o)*(1-r)+(x*(1-o)+n[2*(u*e.width+h)+1]*o)*r]}:(t,i)=>{const a=Math.round(t),s=Math.round(i);return a<0||a>=e.width||s<0||s>=e.height?[0,0]:[n[2*(s*e.width+a)+0],n[2*(s*e.width+a)+1]]}}function m(t,e,n,i,a,s,r,o,l){const c=[];let h=n,u=i,f=0,[d,p]=e(h,u);d*=t.velocityScale,p*=t.velocityScale;const m=Math.sqrt(d*d+p*p);let g,x;c.push({x:h,y:u,t:f,speed:m});for(let y=0;y<t.verticesPerLine;y++){let[n,i]=e(h,u);n*=t.velocityScale,i*=t.velocityScale;const d=Math.sqrt(n*n+i*i);if(d<t.minSpeedThreshold)return c;const p=n/d,m=i/d;if(h+=p*t.segmentLength,u+=m*t.segmentLength,f+=t.segmentLength/d,Math.acos(p*g+m*x)>t.maxTurnAngle)return c;if(t.collisions){const t=Math.round(h*l),e=Math.round(u*l);if(t<0||t>r-1||e<0||e>o-1)return c;const n=s[e*r+t];if(-1!==n&&n!==a)return c;s[e*r+t]=a}c.push({x:h,y:u,t:f,speed:d}),g=p,x=m}return c}function g(t,e,n,i){const a=[],s=new l.Z,r=1/Math.max(t.lineCollisionWidth,1),o=Math.round(n*r),c=Math.round(i*r),h=new Int32Array(o*c);for(let l=0;l<h.length;l++)h[l]=-1;const u=[];for(let l=0;l<i;l+=t.lineSpacing)for(let e=0;e<n;e+=t.lineSpacing)u.push({x:e,y:l,sort:s.getFloat()});u.sort(((t,e)=>t.sort-e.sort));for(const{x:l,y:f}of u)if(s.getFloat()<t.density){const n=m(t,e,l,f,a.length,h,o,c,r);if(n.length<2)continue;a.push(n)}return a}function x(t,e){const n=e.pixels,{width:i,height:a}=e,r=new Float32Array(i*a*2),o=e.mask||new Uint8Array(i*a*2);if(e.mask||o.fill(255),"vector-uv"===t)for(let s=0;s<i*a;s++)r[2*s+0]=n[0][s],r[2*s+1]=-n[1][s];else if("vector-magdir"===t)for(let l=0;l<i*a;l++){const t=n[0][l],e=(0,s.Vl)(n[1][l]),i=Math.cos(e-Math.PI/2),a=Math.sin(e-Math.PI/2);r[2*l+0]=i*t,r[2*l+1]=a*t}return{data:r,mask:o,width:i,height:a}}async function y(t,e,n,a,s,r){const o=performance.now(),l=(0,c.C5)(e.spatialReference);if(!l){const l=await _(t,e,n,a,s,r);return(0,i.Z)("esri-2d-profiler")&&u.info("I.7","loadImagery, early exit (ms)",Math.round(performance.now()-o)),(0,i.Z)("esri-2d-profiler")&&u.info("I.9","Number of parts",1),l}const[f,d]=l.valid,p=d-f,m=Math.ceil(e.width/p),g=e.width/m,x=Math.round(n/m);let y=e.xmin;const w=[],v=performance.now();for(let i=0;i<m;i++){const n=new h.Z({xmin:y,xmax:y+g,ymin:e.ymin,ymax:e.ymax,spatialReference:e.spatialReference});w.push(_(t,n,x,a,s,r)),y+=g}const M=await Promise.all(w);(0,i.Z)("esri-2d-profiler")&&u.info("I.8","All calls to _fetchPart (ms)",Math.round(performance.now()-v)),(0,i.Z)("esri-2d-profiler")&&u.info("I.9","Number of parts",M.length);const b={data:new Float32Array(n*a*2),mask:new Uint8Array(n*a),width:n,height:a};let S=0;for(const i of M){for(let t=0;t<i.height;t++)for(let e=0;e<i.width;e++)S+e>=n||(b.data[2*(t*n+S+e)+0]=i.data[2*(t*i.width+e)+0],b.data[2*(t*n+S+e)+1]=i.data[2*(t*i.width+e)+1],b.mask[t*n+S+e]=i.mask[t*i.width+e]);S+=i.width}return(0,i.Z)("esri-2d-profiler")&&u.info("I.10","loadImagery, general exit (ms)",Math.round(performance.now()-o)),b}async function _(t,e,n,i,a,s){const o={requestProjectedLocalDirections:!0,signal:s};if((0,r.pC)(a)&&(o.timeExtent=a),"imagery"===t.type){await t.load({signal:s});const a=t.rasterInfo.dataType,l=await t.fetchImage(e,n,i,o);return!l||(0,r.Wi)(l.pixelData)||(0,r.Wi)(l.pixelData.pixelBlock)?{data:new Float32Array(n*i*2),mask:new Uint8Array(n*i),width:n,height:i}:x(a,l.pixelData.pixelBlock)}await t.load({signal:s});const l=t.rasterInfo.dataType,c=await t.fetchPixels(e,n,i,o);return!c||(0,r.Wi)(c.pixelBlock)?{data:new Float32Array(n*i*2),mask:new Uint8Array(n*i),width:n,height:i}:x(l,c.pixelBlock)}},1659:(t,e,n)=>{n.d(e,{F:()=>d});n(34276);var i=n(94452),a=n(46541),s=n(78819),r=n(795),o=n(86301),l=n(49399),c=n(26004),h=n(65065),u=n(55261),f=n(35371);class d extends l.s{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;super(),this._source=null,this._symbolizerParameters=null,this._vaoInvalidated=!0,this.coordScale=[1,1],this.height=null,this.stencilRef=0,this.resolution=null,this.pixelRatio=1,this.x=0,this.y=0,this.rotation=0,this.rawPixelData=null,this.width=null,this.source=t}destroy(){var t,e;(0,i.pC)(this.vaoData)&&(null!==(t=this.vaoData.magdir)&&void 0!==t&&t.vao.dispose(),null!==(e=this.vaoData.scalar)&&void 0!==e&&e.vao.dispose(),this.vaoData=null)}get symbolizerParameters(){return this._symbolizerParameters}set symbolizerParameters(t){JSON.stringify(this._symbolizerParameters)!==JSON.stringify(t)&&(this._symbolizerParameters=t,this.invalidateVAO())}get source(){return this._source}set source(t){this._source=t,this.invalidateVAO()}invalidateVAO(){var t,e;!this._vaoInvalidated&&(0,i.pC)(this.vaoData)&&(null!==(t=this.vaoData.magdir)&&void 0!==t&&t.vao.dispose(),null!==(e=this.vaoData.scalar)&&void 0!==e&&e.vao.dispose(),this.vaoData=null,this._vaoInvalidated=!0,this.requestRender())}updateVectorFieldVAO(t){if(this._vaoInvalidated){if(this._vaoInvalidated=!1,(0,i.pC)(this.source)&&(0,i.Wi)(this.vaoData)){const{style:e}=this.symbolizerParameters;switch(e){case"beaufort_ft":case"beaufort_km":case"beaufort_kn":case"beaufort_m":case"beaufort_mi":case"classified_arrow":case"ocean_current_kn":case"ocean_current_m":case"single_arrow":{const e=(0,o.wF)(this.source,this.symbolizerParameters),n=this._createVectorFieldVAO(t.context,e);this.vaoData={magdir:n}}break;case"simple_scalar":{const e=(0,o.K)(this.source,this.symbolizerParameters),n=this._createVectorFieldVAO(t.context,e);this.vaoData={scalar:n}}break;case"wind_speed":{const e=(0,o.wF)(this.source,this.symbolizerParameters),n=this._createVectorFieldVAO(t.context,e),i=(0,o.K)(this.source,this.symbolizerParameters),a=this._createVectorFieldVAO(t.context,i);this.vaoData={magdir:n,scalar:a}}}}this.ready(),this.requestRender()}}_createTransforms(){return{dvs:(0,s.c)()}}setTransform(t){const e=(0,a.g)(this.transforms.dvs),[n,i]=t.toScreenNoRotation([0,0],[this.x,this.y]),s=this.resolution/this.pixelRatio/t.resolution,o=s*this.width,l=s*this.height,c=Math.PI*this.rotation/180;(0,a.h)(e,e,(0,r.f)(n,i)),(0,a.h)(e,e,(0,r.f)(o/2,l/2)),(0,a.r)(e,e,-c),(0,a.h)(e,e,(0,r.f)(-o/2,-l/2)),(0,a.k)(e,e,(0,r.f)(o,l)),(0,a.m)(this.transforms.dvs,t.displayViewMat3,e)}onAttach(){this.invalidateVAO()}onDetach(){this.invalidateVAO()}_createVectorFieldVAO(t,e){const{vertexData:n,indexData:i}=e,a=h.f.createVertex(t,u.l1.STATIC_DRAW,new Float32Array(n)),s=h.f.createIndex(t,u.l1.STATIC_DRAW,new Uint32Array(i)),r=(0,c.cM)("vector-field",{geometry:[{location:0,name:"a_pos",count:2,type:u.g.FLOAT,normalized:!1},{location:1,name:"a_offset",count:2,type:u.g.FLOAT,normalized:!1},{location:2,name:"a_vv",count:2,type:u.g.FLOAT,normalized:!1}]});return{vao:new f.U(t,r.attributes,r.bufferLayouts,{geometry:a},s),elementCount:i.length}}}},94242:(t,e,n)=>{n.d(e,{V:()=>r,e:()=>s});var i=n(94452),a=n(11004);async function s(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.popupTemplate;if((0,i.Wi)(e))return[];const n=await e.getRequiredFields(t.fieldsIndex),{lastEditInfoEnabled:s}=e,{objectIdField:r,typeIdField:o,globalIdField:l,relationships:c}=t;if(n.includes("*"))return["*"];const h=s?await(0,a.CH)(t):[],u=(0,a.Q0)(t.fieldsIndex,[...n,...h]);return o&&u.push(o),u&&r&&t.fieldsIndex.has(r)&&!u.includes(r)&&u.push(r),u&&l&&t.fieldsIndex.has(l)&&!u.includes(l)&&u.push(l),c&&c.forEach((e=>{const{keyField:n}=e;u&&n&&t.fieldsIndex.has(n)&&!u.includes(n)&&u.push(n)})),u}function r(t,e){return t.popupTemplate?t.popupTemplate:(0,i.pC)(e)&&e.defaultPopupTemplateEnabled&&(0,i.pC)(t.defaultPopupTemplate)?t.defaultPopupTemplate:null}}}]);
//# sourceMappingURL=7634.35138a6e.chunk.js.map
"use strict";(self.webpackChunkNJS_Lab=self.webpackChunkNJS_Lab||[]).push([[80068],{71821:(e,t,i)=>{i.d(t,{CS:()=>g,Cw:()=>m,Yu:()=>_,j5:()=>y,lm:()=>w});var s=i(95475),n=i(21671),r=i(43929),o=i(69279),a=i(88034),l=i(83689),h=i(74174),c=i(19862),u=i(42434),p=i(58620),d=i(90967);const f={esriGeometryPoint:"points",esriGeometryPolyline:"polylines",esriGeometryPolygon:"polygons"};function m(e){const t=e.folders||[],i=t.slice(),s=new Map,n=new Map,r=new Map,o=new Map,l=new Map,h={esriGeometryPoint:n,esriGeometryPolyline:r,esriGeometryPolygon:o};(e.featureCollection&&e.featureCollection.layers||[]).forEach((e=>{const t=(0,a.d9)(e);t.featureSet.features=[];const i=e.featureSet.geometryType;s.set(i,t);const l=e.layerDefinition.objectIdField;"esriGeometryPoint"===i?x(n,l,e.featureSet.features):"esriGeometryPolyline"===i?x(r,l,e.featureSet.features):"esriGeometryPolygon"===i&&x(o,l,e.featureSet.features)})),e.groundOverlays&&e.groundOverlays.forEach((e=>{l.set(e.id,e)})),t.forEach((t=>{t.networkLinkIds.forEach((s=>{const n=function(e,t,i){const s=function(e,t){let i;return t.some((t=>t.id===e&&(i=t,!0))),i}(e,i);return s&&(s.parentFolderId=t,s.networkLink=s),s}(s,t.id,e.networkLinks);n&&i.push(n)}))})),i.forEach((e=>{if(e.featureInfos){e.points=(0,a.d9)(s.get("esriGeometryPoint")),e.polylines=(0,a.d9)(s.get("esriGeometryPolyline")),e.polygons=(0,a.d9)(s.get("esriGeometryPolygon")),e.mapImages=[];for(const t of e.featureInfos)switch(t.type){case"esriGeometryPoint":case"esriGeometryPolyline":case"esriGeometryPolygon":{const i=h[t.type].get(t.id);i&&e[f[t.type]].featureSet.features.push(i);break}case"GroundOverlay":{const i=l.get(t.id);i&&e.mapImages.push(i);break}}e.fullExtent=w([e])}}));const c=w(i);return{folders:t,sublayers:i,extent:c}}function g(e,t,i,r){const a=n.id&&n.id.findCredential(e);e=(0,l.fl)(e,{token:a&&a.token});const h=s.Z.kmlServiceUrl;return(0,o.default)(h,{query:{url:e,model:"simple",folders:"",refresh:0!==i||void 0,outSR:JSON.stringify(t)},responseType:"json",signal:r})}function y(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];const n=[],r={},o=t.sublayers,a=t.folders.map((e=>e.id));return o.forEach((t=>{const o=new e;if(i?o.read(t,i):o.read(t),s.length&&a.includes(o.id)&&(o.visible=s.includes(o.id)),r[t.id]=o,null!=t.parentFolderId&&-1!==t.parentFolderId){const e=r[t.parentFolderId];e.sublayers||(e.sublayers=[]),e.sublayers.unshift(o)}else n.unshift(o)})),n}function x(e,t,i){i.forEach((i=>{e.set(i.attributes[t],i)}))}async function _(e){const t=d.default.fromJSON(e.featureSet).features,i=e.layerDefinition,s=(0,p.i)(i.drawingInfo.renderer),n=r.Z.fromJSON(e.popupInfo),o=[];for(const r of t){const e=await s.getSymbolAsync(r);r.symbol=e,r.popupTemplate=n,r.visible=!0,o.push(r)}return o}function w(e){const t=(0,c.Ue)(c.Gv),i=(0,c.Ue)(c.Gv);for(const s of e){if(s.polygons&&s.polygons.featureSet&&s.polygons.featureSet.features)for(const e of s.polygons.featureSet.features)(0,u.Yg)(t,e.geometry),(0,c.TC)(i,t);if(s.polylines&&s.polylines.featureSet&&s.polylines.featureSet.features)for(const e of s.polylines.featureSet.features)(0,u.Yg)(t,e.geometry),(0,c.TC)(i,t);if(s.points&&s.points.featureSet&&s.points.featureSet.features)for(const e of s.points.featureSet.features)(0,u.Yg)(t,e.geometry),(0,c.TC)(i,t);if(s.mapImages)for(const e of s.mapImages)(0,u.Yg)(t,e.extent),(0,c.TC)(i,t)}return(0,c.fS)(i,c.Gv)?null:{xmin:i[0],ymin:i[1],zmin:i[2],xmax:i[3],ymax:i[4],zmax:i[5],spatialReference:h.Z.WGS84}}},27898:(e,t,i)=>{i.d(t,{Hq:()=>W,Mk:()=>m,P_:()=>U,Qp:()=>j,VO:()=>M,_D:()=>P,kZ:()=>Y,kr:()=>H,nF:()=>V,tB:()=>A,ut:()=>L,vF:()=>J,zD:()=>C});var s,n,r=i(18489),o=(i(75254),i(64299)),a=i(94452),l=i(69621),h=i(90320),c=i(62348),u=i(37299),p=i(42836),d=i(13925),f=i(74174);function m(e,t,i){return!(0,c.Up)(e,t,i)}function g(e,t,i){const s=m(e,t,i);if(s&&!(0,c.kR)())throw new o.Z("rasterprojectionhelper-project","projection engine is not loaded");return s}(n=s||(s={}))[n.None=0]="None",n[n.North=1]="North",n[n.South=2]="South",n[n.Both=3]="Both";const y=function(e,t,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(1===i[0])return[0,0];let n=1,r=-1,o=1,a=-1;for(let g=0;g<e.length;g+=2)isNaN(e[g])||(n=n>e[g]?e[g]:n,r=r>e[g]?r:e[g],o=o>e[g+1]?e[g+1]:o,a=a>e[g+1]?a:e[g+1]);const{cols:l,rows:h}=t,c=(r-n)/l/i[0],u=(a-o)/h/i[1],p=2*s;let d=0,f=!1,m=[0,0];for(let g=0;g<l-3;g++){for(let t=0;t<h-3;t++){const i=g*h*2+2*t,s=(e[i]+e[i+4]+e[i+4*h]+e[i+4*h+4])/4,n=(e[i+1]+e[i+5]+e[i+4*h+1]+e[i+4*h+5])/4,r=Math.abs((s-e[i+2*h+2])/c),o=Math.abs((n-e[i+2*h+3])/u);if(r+o>d&&(d=r+o,m=[r,o]),p&&d>p){f=!0;break}}if(f)break}return m},x={3395:20037508.342789244,3410:17334193.943686873,3857:20037508.342788905,3975:17367530.445161372,4087:20037508.342789244,4088:20015108.787169147,6933:17367530.445161372,32662:20037508.342789244,53001:20015086.79602057,53002:10007543.39801029,53003:20015086.79602057,53004:20015086.79602057,53016:14152803.599503474,53017:17333573.624304302,53034:20015086.79602057,53079:20015114.352186374,53080:20015114.352186374,54001:20037508.342789244,54002:10018754.171394624,54003:20037508.342789244,54004:20037508.342789244,54016:14168658.027268292,54017:17367530.44516137,54034:20037508.342789244,54079:20037508.342789244,54080:20037508.342789244,54100:20037508.342789244,54101:20037508.342789244},_=32,w=4,v=w,b=new Map,S=new Map,R=500;async function C(){(0,c.kR)()||await(0,c.zD)()}function P(e,t,i){return g(e.spatialReference,t)?i?(0,c.rS)(t,e.spatialReference,e):(0,c.rS)(e.spatialReference,t,e):null}function M(e,t,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const n=e.spatialReference;if(n.equals(t))return e;g(n,t,s);const r=i.center,o=new u.Z({xmin:r.x-e.x/2,xmax:r.x+e.x/2,ymin:r.y-e.y/2,ymax:r.y+e.y/2,spatialReference:n}),h=(0,c.iV)(o,t,s),p=L(t);let d;if((0,a.Wi)(h)||(0,a.pC)(p)&&h.width>=p){const i=(0,l.c9)(n)/(0,l.c9)(t);d={x:e.x*i,y:e.y*i}}else d={x:h.width,y:h.height};return d}function k(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.01;return(0,l.c9)(e)?t/(0,l.c9)(e):0}function V(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const n=e.spatialReference;if(n.equals(t))return e;g(n,t,i);const r=(0,c.iV)(e,t,i);return s&&r?(T([e],[r],n,t),r):r}function T(e,t,i,s){const n=O(i,!0),r=O(s,!0),o=k(i,R),l=k(s,R);if(o&&(0,a.pC)(n)&&(0,a.pC)(r))for(let a=0;a<e.length;a++){const i=t[a];if(!i)continue;const{x:s}=e[a],{x:h}=i;h>=r[1]-l&&Math.abs(s-n[0])<o?i.x-=r[1]-r[0]:h<=r[0]+l&&Math.abs(s-n[1])<o&&(i.x+=r[1]-r[0])}}function I(e){const{inSR:t,outSR:i,datumTransformation:s,preferPE:n}=e;if(t.equals(i)){const{points:t}=D(e,null);return t}if(t.isWebMercator&&i.isWGS84||t.isWGS84&&i.isWebMercator)return function(e){const{cols:t,rows:i,xres:s,yres:n,usePixelCenter:r,inSR:o,outSR:a}=e;let{xmin:l,ymax:h}=e;r&&(l+=s/2,h-=n/2);const u=[],d=[],f=Math.max(t,i);for(let g=0;g<f;g++){const e=l+s*Math.min(t,g),r=h-n*Math.min(i,g),f=(0,c.iV)(new p.Z({x:e,y:r,spatialReference:o}),a);g<=t&&u.push(f.x),g<=i&&d.push(f.y)}const m=[];for(let c=0;c<t;c++)for(let e=0;e<i;e++)m.push([u[c],d[e]]);return m}(e);if(g(t,i,s)&&n){if(t.isGeographic)return E(e);const i=G(t);if((0,a.pC)(i))return E(e)}return function(e){const{points:t}=D(e,null),{inSR:i,outSR:s,datumTransformation:n}=e,r=t.map((e=>new p.Z(e[0],e[1],i))),o=(0,c.iV)(r,s,n);return n&&T(r,o,i,s),o.map((e=>e?[e.x,e.y]:[NaN,NaN]))}(e)}function E(e){const{inSR:t,outSR:i,datumTransformation:s}=e,n=G(t),{points:r,mask:o}=D(e,n);if(!t.isGeographic){const e=t.wkid?h.e.coordsys(t.wkid):h.e.fromString(t.isGeographic?h.f.PE_TYPE_GEOGCS:h.f.PE_TYPE_PROJCS,t.wkt);h.g.projToGeog(e,r.length,r)}if((0,a.pC)(s)&&s.steps.length){let e;const t=179.9955;if(i.isGeographic&&(e=r.map((e=>{let[i]=e;return i>t?1:i<-t?-1:0}))),s.steps.forEach((e=>{const t=e.wkid?h.e.geogtran(e.wkid):h.e.fromString(h.f.PE_TYPE_GEOGTRAN,e.wkt);h.h.geogToGeog(t,r.length,r,null,e.isInverse?h.f.PE_TRANSFORM_2_TO_1:h.f.PE_TRANSFORM_1_TO_2)})),e)for(let i=0;i<r.length;i++){const s=e[i],n=r[i][0],o=n>t?1:n<-t?-1:0;s&&o&&s!==o&&(r[i][0]=s>0?n+360:n-360)}}if(!i.isGeographic){const e=G(i,!0),t=(0,a.pC)(e)&&e.isEnvelope?[e.bbox[1],e.bbox[3]]:[-90,90];!function(e,t){const[i,s]=t;for(let n=0;n<e.length;n++){const t=e[n][1];(t<i||t>s)&&(e[n]=[NaN,NaN])}}(r,t);const s=i.wkid?h.e.coordsys(i.wkid):h.e.fromString(i.isGeographic?h.f.PE_TYPE_GEOGCS:h.f.PE_TYPE_PROJCS,i.wkt);h.g.geogToProj(s,r.length,r)}let l=r;if(o&&r.length!==o.length){l=[];for(let e=0,t=0;e<o.length;e++)o[e]?l.push(r[t++]):l.push([NaN,NaN])}return l}function G(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=e.wkid||e.wkt;if(!i||e.isGeographic)return null;if(i=String(i),b.has(i)){const e=b.get(i);return t?null===e||void 0===e?void 0:e.gcs:null===e||void 0===e?void 0:e.pcs}const s=e.wkid?h.e.coordsys(e.wkid):h.e.fromString(e.isGeographic?h.f.PE_TYPE_GEOGCS:h.f.PE_TYPE_PROJCS,e.wkt),n=N(s,k(e,1e-4)),r=N(s,0,!0);return b.set(i,{pcs:n,gcs:r}),t?r:n}function N(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const s=h.j.generate(e),n=i?e.horizonGcsGenerate():e.horizonPcsGenerate();if(!s||null===n||void 0===n||!n.length)return null;let r=!1,o=n.find((e=>1===e.getInclusive()&&1===e.getKind()));if(!o){if(o=n.find((e=>1===e.getInclusive()&&0===e.getKind())),!o)return null;r=!0}const a=i?0:(2===s.getNorthPoleLocation()?1:0)|(2===s.getSouthPoleLocation()?2:0),l=s.isPannableRectangle(),c=o.getCoord();if(r)return{isEnvelope:r,isPannable:l,vertices:c,coef:null,bbox:[c[0][0]-t,c[0][1]-t,c[1][0]+t,c[1][1]+t],poleLocation:a};let u=0;const p=[];let[d,f]=c[0],[m,g]=c[0];for(let h=0,y=c.length;h<y;h++){u++,u===y&&(u=0);const[e,t]=c[h],[i,s]=c[u];if(s===t)p.push([e,i,t,s,2]);else{const n=(i-e)/(s-t||1e-4),r=e-n*t;t<s?p.push([n,r,t,s,0]):p.push([n,r,s,t,1])}d=d<e?d:e,f=f<t?f:t,m=m>e?m:e,g=g>t?g:t}return{isEnvelope:!1,isPannable:l,vertices:c,coef:p,bbox:[d,f,m,g],poleLocation:a}}function D(e,t){const i=[],{cols:s,rows:n,xres:r,yres:o,usePixelCenter:l}=e;let{xmin:h,ymax:c}=e;if(l&&(h+=r/2,c-=o/2),(0,a.Wi)(t)){for(let e=0;e<s;e++)for(let t=0;t<n;t++)i.push([h+r*e,c-o*t]);return{points:i}}const u=new Uint8Array(s*n);if(t.isEnvelope){const{bbox:[e,a,l,p]}=t;for(let d=0,f=0;d<s;d++){const s=h+r*d,m=t.isPannable||s>=e&&s<=l;for(let e=0;e<n;e++,f++){const t=c-o*e;m&&t>=a&&t<=p&&(i.push([s,t]),u[f]=1)}}return{points:i,mask:u}}const p=t.coef,d=[];for(let a=0;a<n;a++){const e=c-o*a,t=[],i=[];for(let n=0;n<p.length;n++){const[s,r,o,a,l]=p[n];if(e===o&&o===a)t.push(s),t.push(r),i.push(2),i.push(2);else if(e>=o&&e<=a){const n=s*e+r;t.push(n),i.push(l)}}let s=t;if(t.length>2){let e=2===i[0]?0:i[0],n=t[0];s=[];for(let r=1;r<i.length;r++)2===i[r]&&r!==i.length-1||(i[r]!==e&&(s.push(0===e?Math.min(n,t[r-1]):Math.max(n,t[r-1])),e=i[r],n=t[r]),r===i.length-1&&s.push(0===i[r]?Math.min(n,t[r]):Math.max(n,t[r])));s.sort(((e,t)=>e-t))}else t[0]>t[1]&&(s=[t[1],t[0]]);d.push(s)}for(let a=0,f=0;a<s;a++){const e=h+r*a;for(let t=0;t<n;t++,f++){const s=c-o*t,n=d[t];if(2===n.length)e>=n[0]&&e<=n[1]&&(i.push([e,s]),u[f]=1);else if(n.length>2){let t=!1;for(let i=0;i<n.length;i+=2)if(e>=n[i]&&e<=n[i+1]){t=!0;break}t&&(i.push([e,s]),u[f]=1)}}}return{points:i,mask:u}}function Z(e){const t=L(e[0].spatialReference);if(e.length<2||(0,a.Wi)(t))return e[0];let{xmin:i,xmax:s,ymin:n,ymax:r}=e[0];for(let o=1;o<e.length;o++){const i=e[o];s=i.xmax+t*o,n=Math.min(n,i.ymin),r=Math.max(r,i.ymax)}return new u.Z({xmin:i,xmax:s,ymin:n,ymax:r,spatialReference:e[0].spatialReference})}function A(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const r=e.spatialReference;if(r.equals(t))return e;const o=W(e),l=L(r,!0),h=L(t);if(0===o||(0,a.Wi)(l)||(0,a.Wi)(h)){const o=B(e,t,i,n);if((0,a.Wi)(l)&&(0,a.pC)(h)&&Math.abs(o.width-h)<k(t)&&(0,c.kR)()){const i=G(r);if((0,a.pC)(i)&&i.poleLocation===s.None&&e.width<(i.bbox[2]-i.bbox[0])/2)return function(e,t){const i=L(t);if((0,a.Wi)(i))return null;let{xmin:s,ymin:n,xmax:r,ymax:o}=e;const l=e.spatialReference,h=new d.Z({spatialReference:l,rings:[[[s,n],[r,n],[r,o],[s,o],[s,n]]]}),p=(0,c.iV)(h,t);if(2!==p.rings.length||!p.rings[0].length||!p.rings[1].length)return null;const{rings:f}=p,m=k(l),g=new u.Z({spatialReference:t});for(let a=0;a<2;a++){s=r=f[a][0][0],n=o=f[a][0][1];for(let e=0;e<f[a].length;e++)s=s>f[a][e][0]?f[a][e][0]:s,r=r<f[a][e][0]?f[a][e][0]:r,n=n>f[a][e][1]?f[a][e][1]:n,o=o<f[a][e][1]?f[a][e][1]:o;if(0===a)g.ymin=n,g.ymax=o,g.xmin=s,g.xmax=r;else if(g.ymin=Math.min(g.ymin,n),g.ymax=Math.max(g.ymax,o),Math.abs(r-i/2)<m)g.xmin=s,g.xmax=g.xmax+i;else{if(!(Math.abs(s+i/2)<m))return null;g.xmax=r+i}}return g}(e,t)||o}return o}const p=e.clone().normalize();if(1===p.length&&e.xmax<l&&e.xmax-l/2>k(r)){const{xmin:t,xmax:i}=e;for(let s=0;s<=o;s++){const n=0===s?t:-l/2,a=s===o?i-l*s:l/2;p[s]=new u.Z({xmin:n,xmax:a,ymin:e.ymin,ymax:e.ymax,spatialReference:r})}}return Z(p.map((e=>B(e,t,i,n))).filter(a.pC))}function B(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],n=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const r=e.spatialReference;if(r.equals(t)||!t)return e;g(r,t,i);const o=(0,c.iV)(e,t,i);if(n&&t.isWebMercator&&o&&(o.ymax=Math.min(20037508.342787,o.ymax),o.ymin=Math.max(-20037508.342787,o.ymin),o.ymin>=o.ymax))return null;if(!s||!o)return o;const l=O(r,!0),h=O(t,!0);if((0,a.Wi)(l)||(0,a.Wi)(h))return o;const u=k(r,.001),d=k(r,R),f=k(t,.001);if(Math.abs(o.xmin-h[0])<f&&Math.abs(o.xmax-h[1])<f){const s=Math.abs(e.xmin-l[0]),n=Math.abs(l[1]-e.xmax);if(s<u&&n>d){o.xmin=h[0];const s=[];s.push(new p.Z(e.xmax,e.ymin,r)),s.push(new p.Z(e.xmax,(e.ymin+e.ymax)/2,r)),s.push(new p.Z(e.xmax,e.ymax,r));const n=s.map((e=>V(e,t,i))).filter((e=>!isNaN(null===e||void 0===e?void 0:e.x))).map((e=>e.x));o.xmax=Math.max.apply(null,n)}if(n<u&&s>d){o.xmax=h[1];const s=[];s.push(new p.Z(e.xmin,e.ymin,r)),s.push(new p.Z(e.xmin,(e.ymin+e.ymax)/2,r)),s.push(new p.Z(e.xmin,e.ymax,r));const n=s.map((e=>V(e,t,i))).filter((e=>!isNaN(null===e||void 0===e?void 0:e.x))).map((e=>e.x));o.xmin=Math.min.apply(null,n)}}else{const e=k(t,.001);Math.abs(o.xmin-h[0])<e&&(o.xmin=h[0]),Math.abs(o.xmax-h[1])<e&&(o.xmax=h[1])}return o}function L(e){if(!e)return null;const t=arguments.length>1&&void 0!==arguments[1]&&arguments[1]?20037508.342787:20037508.342788905;return e.isWebMercator?2*t:e.wkid&&e.isGeographic?360:2*x[e.wkid]||null}function O(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e.isGeographic)return[-180,180];const i=L(e,t);return(0,a.pC)(i)?[-i/2,i/2]:null}function q(e,t,i,s){let n=(e-t)/i;return n-Math.floor(n)!=0?n=Math.floor(n):s&&(n-=1),n}function W(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=L(e.spatialReference);if((0,a.Wi)(i))return 0;const s=t?0:-i/2,n=k(e.spatialReference),r=!t&&Math.abs(e.xmax-i/2)<n?i/2:e.xmax,o=!t&&Math.abs(e.xmin+i/2)<n?-i/2:e.xmin;return q(r,s,i,!0)-q(o,s,i,!1)}function U(e){const t=e.storageInfo.origin.x,i=L(e.spatialReference,!0);if((0,a.Wi)(i))return{originX:t,halfWorldWidth:null,pyramidsInfo:null};const s=i/2,{nativePixelSize:n,storageInfo:r,extent:o}=e,{maximumPyramidLevel:l,blockWidth:h,pyramidScalingFactor:c}=r;let u=n.x;const p=[],d=(0,a.pC)(e.transform)&&"gcs-shift"===e.transform.type,f=t+(d?0:s),m=d?i-t:s-t;for(let a=0;a<=l;a++){const e=(o.xmax-t)/u/h,i=e-Math.floor(e)==0?e:Math.ceil(e),s=m/u/h,n=s-Math.floor(s)==0?s:Math.ceil(s),r=Math.floor(f/u/h),a=Math.round(f/u)%h,l=(h-Math.round(m/u)%h)%h;p.push({resolutionX:u,blockWidth:h,datsetColumnCount:i,worldColumnCountFromOrigin:n,leftMargin:a,rightPadding:l,originColumnOffset:r}),u*=c}return{originX:t,halfWorldWidth:s,pyramidsInfo:p,hasGCSSShiftTransform:d}}function j(e){const t=e.isAdaptive&&null==e.spacing;let i=e.spacing||[_,_],s=F(e),n={cols:s.size[0]+1,rows:s.size[1]+1};const o=s.outofBoundPointCount>0&&s.outofBoundPointCount<s.offsets.length/2;let l=s.outofBoundPointCount===s.offsets.length/2||t&&o?[0,0]:y(s.offsets,n,i,v);const c=(l[0]+l[1])/2,u=e.projectedExtent.spatialReference,p=e.srcBufferExtent.spatialReference;if(t&&(o||c>v)&&(m(u,p,e.datumTransformation)&&(u.isGeographic||(0,a.pC)(G(u))),i=[w,w],s=F((0,r.Z)((0,r.Z)({},e),{},{spacing:i})),n={cols:s.size[0]+1,rows:s.size[1]+1},l=y(s.offsets,n,i,v)),s.error=l,i[0]>1&&(s.coefficients=z(s.offsets,n,o)),e.includeGCSGrid&&!u.isGeographic&&!u.isWebMercator)if(p.isGeographic)s.gcsGrid={offsets:s.offsets,coefficients:s.coefficients,spacing:i};else{const t=G(u);if((0,a.pC)(t)&&!t.isEnvelope){const t=function(e){if(!e||e.isGeographic)return e;const t=String(e.wkid||e.wkt);let i;return S.has(t)?i=S.get(t):(i=(e.wkid?h.e.coordsys(e.wkid):h.e.fromString(h.f.PE_TYPE_PROJCS,e.wkt)).getGeogcs().getCode(),S.set(t,i)),new f.Z({wkid:i})}(u),a=A(e.projectedExtent,t),{offsets:l}=F((0,r.Z)((0,r.Z)({},e),{},{srcBufferExtent:a,spacing:i})),c=z(l,n,o);s.gcsGrid={offsets:l,coefficients:c,spacing:i}}}return s}function F(e){const{projectedExtent:t,srcBufferExtent:i,pixelSize:s,datumTransformation:n,rasterTransform:r}=e,o=t.spatialReference,l=i.spatialReference,h=g(o,l),{xmin:c,ymin:u,xmax:d,ymax:f}=t,m=L(l),y=(0,a.pC)(m)&&(e.hasWrapAround||"gcs-shift"===(null===r||void 0===r?void 0:r.type)),x=e.spacing||[_,_],v=x[0]*s.x,b=x[1]*s.y,S=1===x[0],C=Math.ceil((d-c)/v-.1/x[0])+(S?0:1),P=Math.ceil((f-u)/b-.1/x[1])+(S?0:1),M=I({cols:C,rows:P,xmin:c,ymax:f,xres:v,yres:b,inSR:o,outSR:l,datumTransformation:n,preferPE:x[0]<=w,usePixelCenter:S}),V=[];let T,E=0;const N=S?-1:NaN,{xmin:D,xmax:Z,ymax:A,width:B,height:O}=i,q=k(l,R),W=(0,a.pC)(m)&&D>0&&Z>m/2;let U=!1;if(h){const e=G(o);U=(0,a.pC)(e)&&e.poleLocation>0}for(let a=0;a<C;a++){const e=[];for(let t=0;t<P;t++){let i=M[a*P+t];if(y&&i[0]>Z&&i[0]>m/2-q?i[0]-=m:y&&0===a&&i[0]<0&&W&&!r&&(i[0]+=m),!i||isNaN(i[0])||isNaN(i[1]))V.push(N),V.push(N),e.push(null),E++;else{if(r){const e=r.inverseTransform(new p.Z({x:i[0],y:i[1],spatialReference:l}));i=[e.x,e.y]}e.push(i),a>0&&y&&T[t]&&i[0]<T[t][0]&&(i[0]+=m,U&&i[0]>Z&&i[0]>m&&(i[0]-=m)),V.push((i[0]-D)/B),V.push((A-i[1])/O)}}T=e}return{offsets:V,error:null,coefficients:null,outofBoundPointCount:E,spacing:x,size:S?[C,P]:[C-1,P-1]}}function z(e,t,i){const{cols:s,rows:n}=t,r=new Float32Array((s-1)*(n-1)*2*6),o=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),a=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let l=0;l<s-1;l++){for(let t=0;t<n-1;t++){let i=l*n*2+2*t;const h=e[i],c=e[i+1],u=e[i+2],p=e[i+3];i+=2*n;const d=e[i],f=e[i+1],m=e[i+2],g=e[i+3];let y=0,x=12*(t*(s-1)+l);for(let e=0;e<3;e++)r[x++]=o[y++]*h+o[y++]*u+o[y++]*m;y=0;for(let e=0;e<3;e++)r[x++]=o[y++]*c+o[y++]*p+o[y++]*g;y=0;for(let e=0;e<3;e++)r[x++]=a[y++]*h+a[y++]*d+a[y++]*m;y=0;for(let e=0;e<3;e++)r[x++]=a[y++]*c+a[y++]*f+a[y++]*g}if(i)for(let e=0;e<r.length;e++)isNaN(r[e])&&(r[e]=-1)}return r}function Y(e){const t=e.clone().normalize();return 1===t.length?t[0]:Z(t)}function H(e,t,i){const{storageInfo:s,pixelSize:n}=t;let r=0,o=!1;const{pyramidResolutions:h}=s;if((0,a.pC)(h)&&h.length){const s=(e.x+e.y)/2,a=h[h.length-1],c=(a.x+a.y)/2,u=(n.x+n.y)/2;if(s<=u)r=0;else if(s>=c)r=h.length,o=s/c>8;else{let e,t=u;for(let n=1;n<=h.length;n++){if(e=(h[n-1].x+h[n-1].y)/2,s<=e){s===e?r=n:"down"===i?(r=n-1,o=s/t>8):r="up"===i||s-t>e-s||s/t>2?n:n-1;break}t=e}}const d=0===r?n:h[r-1];return o&&Math.min(d.x,d.y)*(0,l.c9)(t.spatialReference)>19567&&(o=!1),{pyramidLevel:r,pyramidResolution:new p.Z({x:d.x,y:d.y,spatialReference:t.spatialReference}),excessiveReading:o}}const c=Math.log(e.x/n.x)/Math.LN2,u=Math.log(e.y/n.y)/Math.LN2,d=t.storageInfo.maximumPyramidLevel||0;r="down"===i?Math.floor(Math.min(c,u)):"up"===i?Math.ceil(Math.max(c,u)):Math.round((c+u)/2),r<0?r=0:r>d&&(o=r>d+3,r=d);const f=2**r;return{pyramidLevel:r,pyramidResolution:new p.Z({x:f*t.nativePixelSize.x,y:f*t.nativePixelSize.y,spatialReference:t.spatialReference}),excessiveReading:o}}function J(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:512,s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const{extent:n,spatialReference:r,pixelSize:o}=e,h=M(new p.Z({x:o.x,y:o.y,spatialReference:r}),t,n);if(null==h)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};const c=(h.x+h.y)/2,u=(0,l.c9)(t),d=c*u*96*39.37,f=t.isGeographic?256/i*295828763.7958547:256/i*591657527.591555;let m="vector-magdir"===e.dataType||"vector-uv"===e.dataType;const g=A(n,t),y=Math.min(Math.ceil(Math.log(Math.min(e.width,e.height)/32)/Math.LN2),Math.ceil(Math.log(f/2/d)/Math.LN2));if(!m&&s&&(t.isGeographic||t.isWebMercator)&&(m=g.xmin*g.xmax<0,!m&&y<3)){const e=L(t);if((0,a.pC)(e)){const t=2**y*c*i,s=Math.ceil(e/t);m=1===s||2===s&&e/2-g.xmax<t}}let x,_=d;const w=1.001;if(m){_=f;const e=t.isGeographic?1341104507446289e-21:.29858214164761665,i=e*(96*u*39.37),s=t.isGeographic?4326:3857;x=M(new p.Z({x:e,y:e,spatialReference:{wkid:s}}),r,g),x.x*=_/i,x.y*=_/i}else{x={x:o.x,y:o.y};let e=0;for(;_<f*(w/2)&&e<y;)e++,_*=2,x.x*=2,x.y*=2;Math.max(_,f)/Math.min(_,f)<=w&&(_=f)}const v=[_],b=[{x:x.x,y:x.y}],S=Math.min(70.5310735,d)/w;for(;_>=S;)_/=2,x.x/=2,x.y/=2,v.push(_),b.push({x:x.x,y:x.y});return{projectedPixelSize:h,scales:v,srcResolutions:b,isCustomTilingScheme:!m}}},19481:(e,t,i)=>{i.d(t,{JZ:()=>d,RL:()=>f,eY:()=>m});var s=i(94452),n=i(3341),r=i(46541),o=i(78819),a=i(795),l=i(49399),h=i(28065),c=i(36269),u=i(55261),p=i(98552);function d(e){return e&&"render"in e}function f(e){const t=document.createElement("canvas");return t.width=e.width,t.height=e.height,e.render(t.getContext("2d")),t}class m extends l.s{constructor(){var e,t;let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,s=arguments.length>1?arguments[1]:void 0;super(),this.blendFunction="standard",this._sourceWidth=0,this._sourceHeight=0,this._textureInvalidated=!1,this.stencilRef=0,this.coordScale=[1,1],this._height=void 0,this.pixelRatio=1,this.resolution=0,this.rotation=0,this._source=null,this._width=void 0,this.x=0,this.y=0,this.immutable=null!==(e=s.immutable)&&void 0!==e&&e,this.requestRenderOnSourceChangedEnabled=null===(t=s.requestRenderOnSourceChangedEnabled)||void 0===t||t,this.source=i,this.requestRender=this.requestRender.bind(this)}destroy(){this._texture&&(this._texture.dispose(),this._texture=null),(0,s.pC)(this._uploadStatus)&&(this._uploadStatus.controller.abort(),this._uploadStatus=null)}get isSourceScaled(){return this.width!==this._sourceWidth||this.height!==this._sourceHeight}get height(){return void 0!==this._height?this._height:this._sourceHeight}set height(e){this._height=e}get source(){return this._source}set source(e){null==e&&null==this._source||(this._source=e,this._source instanceof HTMLImageElement?(this._sourceHeight=this._source.naturalHeight,this._sourceWidth=this._source.naturalWidth):(this._sourceHeight=this._source.height,this._sourceWidth=this._source.width),this.invalidateTexture())}get width(){return void 0!==this._width?this._width:this._sourceWidth}set width(e){this._width=e}beforeRender(e){super.beforeRender(e),this.updateTexture(e)}async setSourceAsync(e,t){(0,s.pC)(this._uploadStatus)&&this._uploadStatus.controller.abort();const i=new AbortController,r=(0,n.hh)();return(0,n.$F)(t,(()=>i.abort())),(0,n.$F)(i,(e=>r.reject(e))),this._uploadStatus={controller:i,resolver:r},this.source=e,r.promise}invalidateTexture(){this._textureInvalidated||(this._textureInvalidated=!0,this.requestRenderOnSourceChangedEnabled&&this.requestRender())}updateTransitionProperties(e,t){e>=64&&(this.fadeTransitionEnabled=!1,this.inFadeTransition=!1),super.updateTransitionProperties(e,t)}setTransform(e){const t=(0,r.g)(this.transforms.dvs),[i,s]=e.toScreenNoRotation([0,0],[this.x,this.y]),n=this.resolution/this.pixelRatio/e.resolution,o=n*this.width,l=n*this.height,h=Math.PI*this.rotation/180;(0,r.h)(t,t,(0,a.f)(i,s)),(0,r.h)(t,t,(0,a.f)(o/2,l/2)),(0,r.r)(t,t,-h),(0,r.h)(t,t,(0,a.f)(-o/2,-l/2)),(0,r.k)(t,t,(0,a.f)(o,l)),(0,r.m)(this.transforms.dvs,e.displayViewMat3,t)}setSamplingProfile(e){this._texture&&(e.mips&&!this._texture.descriptor.hasMipmap&&this._texture.generateMipmap(),this._texture.setSamplingMode(e.samplingMode))}bind(e,t){this._texture&&e.bindTexture(this._texture,t)}async updateTexture(e){let{context:t,painter:i}=e;if(!this._textureInvalidated)return;if(this._textureInvalidated=!1,this._texture||(this._texture=this._createTexture(t)),!this.source)return void this._texture.setData(null);this._texture.resize(this._sourceWidth,this._sourceHeight);const r=d(o=this.source)?o instanceof h.Z?(0,s.yw)(o.getRenderedRasterPixels(),(e=>e.renderedRasterPixels)):f(o):o;var o;try{if((0,s.pC)(this._uploadStatus)){const{controller:e,resolver:t}=this._uploadStatus,s={signal:e.signal},{width:n,height:o}=this,a=this._texture,l=i.textureUploadManager;await l.enqueueTextureUpdate({data:r,texture:a,width:n,height:o},s),t.resolve(),this._uploadStatus=null}else this._texture.setData(r);this.ready()}catch(a){(0,n.H9)(a)}}onDetach(){this.destroy()}_createTransforms(){return{dvs:(0,o.c)()}}_createTexture(e){const t=this.immutable&&e.type===c.zO.WEBGL2;return new p.x(e,{target:u.No.TEXTURE_2D,pixelFormat:u.VI.RGBA,internalFormat:t?u.lP.RGBA8:u.VI.RGBA,dataType:u.Br.UNSIGNED_BYTE,wrapMode:u.e8.CLAMP_TO_EDGE,isImmutable:t,width:this._sourceWidth,height:this._sourceHeight})}}},84005:(e,t,i)=>{i.d(t,{c:()=>o});var s=i(96803),n=i(51116),r=i(48925);class o extends r.Z{constructor(){super(...arguments),this._hasCrossfade=!1}get requiresDedicatedFBO(){return this._hasCrossfade}beforeRender(e){super.beforeRender(e),this._manageFade()}prepareRenderPasses(e){const t=e.registerRenderPass({name:"bitmap",brushes:[s.U.bitmap],target:()=>this.children,drawPhase:n.jx.MAP});return[...super.prepareRenderPasses(e),t]}_manageFade(){this.children.reduce(((e,t)=>e+(t.inFadeTransition?1:0)),0)>=2?(this.children.forEach((e=>e.blendFunction="additive")),this._hasCrossfade=!0):(this.children.forEach((e=>e.blendFunction="standard")),this._hasCrossfade=!1)}}},28065:(e,t,i)=>{i.d(t,{Z:()=>n});var s=i(94452);class n{constructor(e,t,i){this.pixelBlock=e,this.extent=t,this.originalPixelBlock=i}get width(){return(0,s.pC)(this.pixelBlock)?this.pixelBlock.width:0}get height(){return(0,s.pC)(this.pixelBlock)?this.pixelBlock.height:0}render(e){const t=this.pixelBlock;if((0,s.Wi)(t))return;const i=this.filter({pixelBlock:t});if((0,s.Wi)(i.pixelBlock))return;const n=i.pixelBlock.getAsRGBA(),r=e.createImageData(i.pixelBlock.width,i.pixelBlock.height);r.data.set(n),e.putImageData(r,0,0)}getRenderedRasterPixels(){const e=this.filter({pixelBlock:this.pixelBlock});return(0,s.Wi)(e.pixelBlock)?null:{width:e.pixelBlock.width,height:e.pixelBlock.height,renderedRasterPixels:new Uint8Array(e.pixelBlock.getAsRGBA().buffer)}}}},80068:(e,t,i)=>{i.r(t),i.d(t,{default:()=>A});var s=i(18489),n=i(78808),r=i(21671),o=i(75468),a=i(94452),l=i(51654),h=i(83689),c=i(90754),u=(i(83194),i(75476),i(90825)),p=i(37299),d=i(62348),f=i(74174),m=i(71821),g=i(50587),y=i(43525),x=i(19481),_=i(84005),w=i(36268),v=i(56019),b=i(65967),S=i(52230),R=i(69279),C=i(42836),P=i(27898),M=i(991),k=i(81157),V=i(55261),T=i(54939),I=i(98940),E=i(60535),G=i(98552);class N{constructor(e){if(e)this._ownsRctx=!1,this._rctx=e;else{if(N._instance)return N._instanceRefCount++,N._instance;N._instanceRefCount=1,N._instance=this,this._ownsRctx=!0;const e=document.createElement("canvas").getContext("webgl");e.getExtension("OES_texture_float"),this._rctx=new E.x(e,{})}const t=(0,k.s)("raster/reproject","raster/reproject",new Map([["a_position",0]]),{applyProjection:!0,bilinear:!1,bicubic:!1});this._program=this._rctx.programCache.acquire(t.shaders.vertexShader,t.shaders.fragmentShader,t.attributes),this._rctx.useProgram(this._program),this._program.setUniform1f("u_opacity",1),this._program.setUniform1i("u_image",0),this._program.setUniform1i("u_flipY",0),this._program.setUniform1i("u_transformGrid",1),this._quad=new M.Z(this._rctx,[0,0,1,0,0,1,1,1])}reprojectTexture(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const s=(0,d.iV)(e.extent,t),n=new C.Z({x:(e.extent.xmax-e.extent.xmin)/e.texture.descriptor.width,y:(e.extent.ymax-e.extent.ymin)/e.texture.descriptor.height,spatialReference:e.extent.spatialReference}),{x:r,y:o}=(0,P.VO)(n,t,e.extent);let a=(r+o)/2;const l=Math.round((s.xmax-s.xmin)/a),h=Math.round((s.ymax-s.ymin)/a);a=(s.width/l+s.height/h)/2;const c=new C.Z({x:a,y:a,spatialReference:s.spatialReference}),u=(0,P.Qp)({projectedExtent:s,srcBufferExtent:e.extent,pixelSize:c,hasWrapAround:!0,spacing:[16,16]}),p=(0,I.Br)(this._rctx,u),f=new G.x(this._rctx,{width:l,height:h,pixelFormat:V.VI.RGBA,dataType:V.Br.UNSIGNED_BYTE,wrapMode:V.e8.CLAMP_TO_EDGE,samplingMode:V.cw.LINEAR,hasMipmap:!1}),m=new T.X(this._rctx,{colorTarget:V.Lm.TEXTURE,depthStencilTarget:V.OU.NONE,width:l,height:h},f);if(this._rctx.bindFramebuffer(m),this._rctx.setViewport(0,0,l,h),this._rctx.useProgram(this._program),this._rctx.bindTexture(e.texture,0),this._rctx.bindTexture(p,1),this._quad.bind(),this._program.setUniform2f("u_srcImageSize",e.texture.descriptor.width,e.texture.descriptor.height),this._program.setUniform2fv("u_transformSpacing",u.spacing),this._program.setUniform2fv("u_transformGridSize",u.size),this._program.setUniform2f("u_targetImageSize",l,h),this._quad.draw(),this._quad.unbind(),this._rctx.useProgram(null),this._rctx.bindFramebuffer(null),p.dispose(),i){const e=new ImageData(m.descriptor.width,m.descriptor.height);return m.readPixels(0,0,m.descriptor.width,m.descriptor.height,V.VI.RGBA,V.Br.UNSIGNED_BYTE,e.data),m.detachColorTexture(V.VY.COLOR_ATTACHMENT0),m.dispose(),{texture:f,extent:s,imageData:e}}return m.detachColorTexture(V.VY.COLOR_ATTACHMENT0),m.dispose(),{texture:f,extent:s}}reprojectBitmapData(e,t){const i=(0,x.JZ)(e.bitmapData)?(0,x.RL)(e.bitmapData):e.bitmapData,s=new G.x(this._rctx,{width:e.bitmapData.width,height:e.bitmapData.height,pixelFormat:V.VI.RGBA,dataType:V.Br.UNSIGNED_BYTE,wrapMode:V.e8.CLAMP_TO_EDGE,samplingMode:V.cw.LINEAR,hasMipmap:!1},i),n=this.reprojectTexture({texture:s,extent:e.extent},t,!0);n.texture.dispose();const r=document.createElement("canvas");return r.width=n.imageData.width,r.height=n.imageData.height,r.getContext("2d").putImageData(n.imageData,0,0),{bitmapData:r,extent:n.extent}}async loadAndReprojectBitmapData(e,t,i){const s=(await(0,R.default)(e,{responseType:"image"})).data,n=document.createElement("canvas");n.width=s.width,n.height=s.height;const r=n.getContext("2d");r.drawImage(s,0,0);const o=r.getImageData(0,0,n.width,n.height);if(t.spatialReference.equals(i))return{bitmapData:o,extent:t};const a=this.reprojectBitmapData({bitmapData:o,extent:t},i);return{bitmapData:a.bitmapData,extent:a.extent}}destroy(){this._ownsRctx?(N._instanceRefCount--,0===N._instanceRefCount&&(this._quad.dispose(),this._program.dispose(),this._rctx.dispose(),N._instance=null)):(this._quad.dispose(),this._program.dispose())}}N._instanceRefCount=0;class D{constructor(){this.allSublayers=new Map,this.allPoints=[],this.allPolylines=[],this.allPolygons=[],this.allMapImages=[]}}let Z=class extends((0,w.y)(S.Z)){constructor(){super(...arguments),this._bitmapIndex=new Map,this._mapImageContainer=new _.c,this._kmlVisualData=new D,this.allVisiblePoints=new y.J,this.allVisiblePolylines=new y.J,this.allVisiblePolygons=new y.J,this.allVisibleMapImages=new o.Z}async hitTest(e,t){var i,s,n;const r=this.layer;return[null===(i=this._pointsView)||void 0===i?void 0:i.hitTest(e),null===(s=this._polylinesView)||void 0===s?void 0:s.hitTest(e),null===(n=this._polygonsView)||void 0===n?void 0:n.hitTest(e)].flat().filter(Boolean).map((t=>(t.layer=r,t.sourceLayer=r,{type:"graphic",graphic:t,layer:r,mapPoint:e})))}update(e){this._polygonsView&&this._polygonsView.processUpdate(e),this._polylinesView&&this._polylinesView.processUpdate(e),this._pointsView&&this._pointsView.processUpdate(e)}attach(){this._fetchController=new AbortController,this.container.addChild(this._mapImageContainer),this._polygonsView=new b.Z({view:this.view,graphics:this.allVisiblePolygons,requestUpdateCallback:()=>this.requestUpdate(),container:new v.Z(this.view.featuresTilingScheme)}),this.container.addChild(this._polygonsView.container),this._polylinesView=new b.Z({view:this.view,graphics:this.allVisiblePolylines,requestUpdateCallback:()=>this.requestUpdate(),container:new v.Z(this.view.featuresTilingScheme)}),this.container.addChild(this._polylinesView.container),this._pointsView=new b.Z({view:this.view,graphics:this.allVisiblePoints,requestUpdateCallback:()=>this.requestUpdate(),container:new v.Z(this.view.featuresTilingScheme)}),this.container.addChild(this._pointsView.container),this.handles.add([this.allVisibleMapImages.on("change",(e=>{e.added.forEach((e=>this._addMapImage(e))),e.removed.forEach((e=>this._removeMapImage(e)))})),(0,l.YP)((()=>this.layer.visibleSublayers),(e=>{for(const[t,i]of this._kmlVisualData.allSublayers)i.visibility=0;for(const t of e){const e=this._kmlVisualData.allSublayers.get(t.id);e&&(e.visibility=1)}this._refreshCollections()}))]),this.updatingHandles.addPromise(this._fetchService(this._fetchController.signal)),this._imageReprojector=new N}detach(){this._fetchController.abort(),this._fetchController=null,this._mapImageContainer.removeAllChildren(),this.container.removeAllChildren(),this._bitmapIndex.clear(),this._polygonsView&&(this._polygonsView.destroy(),this._polygonsView=null),this._polylinesView&&(this._polylinesView.destroy(),this._polylinesView=null),this._pointsView&&(this._pointsView.destroy(),this._pointsView=null),this._imageReprojector&&(this._imageReprojector.destroy(),this._imageReprojector=null)}moveStart(){}viewChange(){this._polygonsView.viewChange(),this._polylinesView.viewChange(),this._pointsView.viewChange()}moveEnd(){}isUpdating(){return this._pointsView.updating||this._polygonsView.updating||this._polylinesView.updating}_addMapImage(e){(this.view.spatialReference.isWGS84||this.view.spatialReference.isWebMercator)&&this._imageReprojector.loadAndReprojectBitmapData(e.href,p.Z.fromJSON(e.extent),this.view.spatialReference).then((t=>{const i=new x.eY(t.bitmapData,{immutable:!1,requestRenderOnSourceChangedEnabled:!0});i.x=t.extent.xmin,i.y=t.extent.ymax,i.resolution=t.extent.width/t.bitmapData.width,i.rotation=e.rotation,this._mapImageContainer.addChild(i),this._bitmapIndex.set(e,i)}))}async _getViewDependentUrl(e,t){const{viewFormat:i,viewBoundScale:n,httpQuery:o}=e;if((0,a.pC)(i)){if((0,a.Wi)(t))throw new Error("Loading this network link requires a view state.");let l;if(await(0,d.zD)(),(0,a.pC)(n)&&1!==n){const e=new p.Z(t.extent);e.expand(n),l=e}else l=t.extent;l=(0,d.iV)(l,f.Z.WGS84);const c=(0,d.iV)(l,f.Z.WebMercator),u=l.xmin,m=l.xmax,y=l.ymin,x=l.ymax,_=t.size[0]*t.pixelRatio,w=t.size[1]*t.pixelRatio,v=Math.max(c.width,c.height),b={"[bboxWest]":u.toString(),"[bboxEast]":m.toString(),"[bboxSouth]":y.toString(),"[bboxNorth]":x.toString(),"[lookatLon]":l.center.x.toString(),"[lookatLat]":l.center.y.toString(),"[lookatRange]":v.toString(),"[lookatTilt]":"0","[lookatHeading]":t.rotation.toString(),"[lookatTerrainLon]":l.center.x.toString(),"[lookatTerrainLat]":l.center.y.toString(),"[lookatTerrainAlt]":"0","[cameraLon]":l.center.x.toString(),"[cameraLat]":l.center.y.toString(),"[cameraAlt]":v.toString(),"[horizFov]":"60","[vertFov]":"60","[horizPixels]":_.toString(),"[vertPixels]":w.toString(),"[terrainEnabled]":"0","[clientVersion]":r.i8,"[kmlVersion]":"2.2","[clientName]":"ArcGIS API for JavaScript","[language]":"en-US"},S=e=>{for(const t in e)for(const i in b)e[t]=e[t].replace(i,b[i])},R=(0,h.u0)(i);S(R);let C={};(0,a.pC)(o)&&(C=(0,h.u0)(o),S(C));const P=(0,g.en)(e.href);return P.query=(0,s.Z)((0,s.Z)((0,s.Z)({},P.query),R),C),"".concat(P.path,"?").concat((0,h.B7)(R))}return e.href}async _fetchService(e){const t=new D;await this._loadVisualData(this.layer.url,t,e),this._kmlVisualData=t,this._refreshCollections()}_refreshCollections(){this.allVisiblePoints.removeAll(),this.allVisiblePolylines.removeAll(),this.allVisiblePolygons.removeAll(),this.allVisibleMapImages.removeAll(),this.allVisiblePoints.addMany(this._kmlVisualData.allPoints.filter((e=>this._isSublayerVisible(e.sublayerId))).map((e=>{let{item:t}=e;return t}))),this.allVisiblePolylines.addMany(this._kmlVisualData.allPolylines.filter((e=>this._isSublayerVisible(e.sublayerId))).map((e=>{let{item:t}=e;return t}))),this.allVisiblePolygons.addMany(this._kmlVisualData.allPolygons.filter((e=>this._isSublayerVisible(e.sublayerId))).map((e=>{let{item:t}=e;return t}))),this.allVisibleMapImages.addMany(this._kmlVisualData.allMapImages.filter((e=>this._isSublayerVisible(e.sublayerId))).map((e=>{let{item:t}=e;return t})))}_isSublayerVisible(e){const t=this._kmlVisualData.allSublayers.get(e);return!!t.visibility&&(-1===t.parentFolderId||this._isSublayerVisible(t.parentFolderId))}_loadVisualData(e,t,i){return this._fetchParsedKML(e,i).then((async e=>{for(const s of e.sublayers){t.allSublayers.set(s.id,s);const e=s.points?await(0,m.Yu)(s.points):[],n=s.polylines?await(0,m.Yu)(s.polylines):[],r=s.polygons?await(0,m.Yu)(s.polygons):[],o=s.mapImages||[];if(t.allPoints.push(...e.map((e=>({item:e,sublayerId:s.id})))),t.allPolylines.push(...n.map((e=>({item:e,sublayerId:s.id})))),t.allPolygons.push(...r.map((e=>({item:e,sublayerId:s.id})))),t.allMapImages.push(...o.map((e=>({item:e,sublayerId:s.id})))),s.networkLink){const e=await this._getViewDependentUrl(s.networkLink,this.view.state);await this._loadVisualData(e,t,i)}}}))}_fetchParsedKML(e,t){return(0,m.CS)(e,this.layer.spatialReference,this.layer.refreshInterval,t).then((e=>(0,m.Cw)(e.data)))}_removeMapImage(e){const t=this._bitmapIndex.get(e);t&&(this._mapImageContainer.removeChild(t),this._bitmapIndex.delete(e))}};(0,n._)([(0,c.Cb)()],Z.prototype,"_pointsView",void 0),(0,n._)([(0,c.Cb)()],Z.prototype,"_polylinesView",void 0),(0,n._)([(0,c.Cb)()],Z.prototype,"_polygonsView",void 0),(0,n._)([(0,c.Cb)()],Z.prototype,"updating",void 0),Z=(0,n._)([(0,u.j)("esri.views.2d.layers.KMLLayerView2D")],Z);const A=Z},36268:(e,t,i)=>{i.d(t,{y:()=>k});var s=i(78808),n=i(75468),r=i(17586),o=i(64299),a=i(51654),l=i(90754),h=(i(83194),i(75476),i(90825)),c=i(85447),u=i(34178);let p=class extends u.wq{get version(){return this.commitVersionProperties(),(this._get("version")||0)+1}};(0,s._)([(0,l.Cb)({readOnly:!0})],p.prototype,"version",null),p=(0,s._)([(0,h.j)("esri.views.layers.support.ClipArea")],p);const d=p;var f;let m=f=class extends d{constructor(e){super(e),this.type="rect",this.left=null,this.right=null,this.top=null,this.bottom=null}clone(){return new f({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}commitVersionProperties(){this.commitProperty("left"),this.commitProperty("right"),this.commitProperty("top"),this.commitProperty("bottom")}};(0,s._)([(0,l.Cb)({type:[Number,String],json:{write:!0}})],m.prototype,"left",void 0),(0,s._)([(0,l.Cb)({type:[Number,String],json:{write:!0}})],m.prototype,"right",void 0),(0,s._)([(0,l.Cb)({type:[Number,String],json:{write:!0}})],m.prototype,"top",void 0),(0,s._)([(0,l.Cb)({type:[Number,String],json:{write:!0}})],m.prototype,"bottom",void 0),m=f=(0,s._)([(0,h.j)("esri.views.layers.support.ClipRect")],m);const g=m;i(75254);var y,x=i(35730),_=i(57669),w=i(37299),v=i(13925);const b={base:x.Z,key:"type",typeMap:{extent:w.Z,polygon:v.Z}};let S=y=class extends d{constructor(e){super(e),this.type="geometry",this.geometry=null}clone(){var e,t;return new y({geometry:null!==(e=null===(t=this.geometry)||void 0===t?void 0:t.clone())&&void 0!==e?e:null})}commitVersionProperties(){this.commitProperty("geometry")}};(0,s._)([(0,l.Cb)({types:b,json:{read:_.im,write:!0}})],S.prototype,"geometry",void 0),S=y=(0,s._)([(0,h.j)("esri.views.layers.support.Geometry")],S);const R=S;let C=class extends d{constructor(e){super(e),this.type="path",this.path=[]}commitVersionProperties(){this.commitProperty("path")}};(0,s._)([(0,l.Cb)({type:[[[Number]]],json:{write:!0}})],C.prototype,"path",void 0),C=(0,s._)([(0,h.j)("esri.views.layers.support.Path")],C);const P=C,M=n.Z.ofType({key:"type",base:null,typeMap:{rect:g,path:P,geometry:R}}),k=e=>{let t=class extends e{constructor(){super(...arguments),this.attached=!1,this.clips=new M,this.lastUpdateId=-1,this.moving=!1,this.updateRequested=!1,this.visibleAtCurrentScale=!1}initialize(){var e,t,i,s;const n=null===(e=null===(t=this.view)||void 0===t?void 0:t.spatialReferenceLocked)||void 0===e||e;(null===(i=this.view)||void 0===i?void 0:i.spatialReference)&&n&&!this.spatialReferenceSupported?this.addResolvingPromise(Promise.reject(new o.Z("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new c.W),this.container.fadeTransitionEnabled=!0,this.container.visible=!1,this.container.endTransitions(),this.handles.add([(0,a.YP)((()=>this.suspended),(e=>{this.container&&(this.container.visible=!e),this.view&&!e&&this.updateRequested&&this.view.requestUpdate()}),a.tX),(0,a.YP)((()=>{var e,t;return null!==(e=null===(t=this.layer)||void 0===t?void 0:t.opacity)&&void 0!==e?e:1}),(e=>{this.container&&(this.container.opacity=e)}),a.tX),(0,a.YP)((()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal"),(e=>{this.container&&(this.container.blendMode=e)}),a.tX),(0,a.YP)((()=>this.layer&&"effect"in this.layer?this.layer.effect:null),(e=>{this.container&&(this.container.effect=e)}),a.tX),(0,a.on)((()=>this.clips),"change",(()=>{this.container&&(this.container.clips=this.clips)}),a.tX),(0,a.YP)((()=>{var e;return{scale:null===(e=this.view)||void 0===e?void 0:e.scale,scaleRange:this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null}}),(e=>{let{scale:t}=e;const i=t&&this.isVisibleAtScale(t);i!==this.visibleAtCurrentScale&&this._set("visibleAtCurrentScale",i)}),a.tX)]),null!==(s=this.view)&&void 0!==s&&s.whenLayerView?this.view.whenLayerView(this.layer).then((e=>{e===this&&this.processAttach()}),(()=>{})):this.when().then((()=>{this.processAttach()}),(()=>{})))}destroy(){this.processDetach(),this.updateRequested=!1}get spatialReferenceSupported(){var e;const t=null===(e=this.view)||void 0===e?void 0:e.spatialReference;return null==t||this.supportsSpatialReference(t)}get updating(){var e;return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!(null===(e=this.updatingHandles)||void 0===e||!e.updating))}processAttach(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())}processDetach(){this.attached&&(this.attached=!1,this.detach(),this.updateRequested=!1)}isVisibleAtScale(e){const t=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;if(!t)return!0;const{minScale:i,maxScale:s}=t;return(0===i||e<=i)&&(0===s||e>=s)}requestUpdate(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())}processUpdate(e){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",e),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(e))):this.updateRequested=!1}hitTest(e,t){return Promise.resolve(null)}supportsSpatialReference(e){return!0}canResume(){return!!this.spatialReferenceSupported&&!!super.canResume()&&this.visibleAtCurrentScale}getSuspendInfo(){const e=super.getSuspendInfo(),t=!this.spatialReferenceSupported,i=this.visibleAtCurrentScale;return t&&(e.spatialReferenceNotSupported=t),i&&(e.outsideScaleRange=i),e}};return(0,s._)([(0,l.Cb)()],t.prototype,"attached",void 0),(0,s._)([(0,l.Cb)({type:M,set(e){const t=(0,r.Z)(e,this._get("clips"),M);this._set("clips",t)}})],t.prototype,"clips",void 0),(0,s._)([(0,l.Cb)()],t.prototype,"container",void 0),(0,s._)([(0,l.Cb)()],t.prototype,"moving",void 0),(0,s._)([(0,l.Cb)({readOnly:!0})],t.prototype,"spatialReferenceSupported",null),(0,s._)([(0,l.Cb)({readOnly:!0})],t.prototype,"updateParameters",void 0),(0,s._)([(0,l.Cb)()],t.prototype,"updateRequested",void 0),(0,s._)([(0,l.Cb)()],t.prototype,"updating",null),(0,s._)([(0,l.Cb)()],t.prototype,"view",void 0),(0,s._)([(0,l.Cb)({readOnly:!0})],t.prototype,"visibleAtCurrentScale",void 0),t=(0,s._)([(0,h.j)("esri.views.2d.layers.LayerView2D")],t),t}},52230:(e,t,i)=>{i.d(t,{Z:()=>f});var s=i(78808),n=i(18891),r=i(22126),o=i(99379),a=i(41243),l=i(92249),h=i(94452),c=i(19755),u=i(90754),p=(i(83194),i(75476),i(90825));let d=class extends((0,o.p)((0,a.IG)((0,c.v)(r.Z.EventedMixin(n.Z))))){constructor(e){super(e),this.layer=null,this.parent=null}initialize(){this.when().catch((e=>{if("layerview:create-error"!==e.name){const t=this.layer&&this.layer.id||"no id",i=this.layer&&this.layer.title||"no title";l.Z.getLogger(this.declaredClass).error("#resolve()","Failed to resolve layer view (layer title: '".concat(i,"', id: '").concat(t,"')"),e)}}))}get fullOpacity(){return(0,h.Pt)(this.get("layer.opacity"),1)*(0,h.Pt)(this.get("parent.fullOpacity"),1)}get suspended(){return!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){var e;return!this.suspended&&!0===(null===(e=this.layer)||void 0===e?void 0:e.legendEnabled)}get updating(){var e;return!((null===(e=this.updatingHandles)||void 0===e||!e.updating)&&!this.isUpdating())}get updatingProgress(){return this.updating?0:1}get visible(){var e;return!0===(null===(e=this.layer)||void 0===e?void 0:e.visible)}set visible(e){this._overrideIfSome("visible",e)}canResume(){var e,t,i;return this.visible&&(null===(e=this.layer)||void 0===e?void 0:e.loaded)&&!(null!==(t=this.parent)&&void 0!==t&&t.suspended)&&(null===(i=this.view)||void 0===i?void 0:i.ready)||!1}getSuspendInfo(){const e=this.parent&&this.parent.suspended?this.parent.suspendInfo:{};return this.view&&this.view.ready||(e.viewNotReady=!0),this.layer&&this.layer.loaded||(e.layerNotLoaded=!0),this.visible||(e.layerInvisible=!0),e}isUpdating(){return!1}};(0,s._)([(0,u.Cb)()],d.prototype,"fullOpacity",null),(0,s._)([(0,u.Cb)()],d.prototype,"layer",void 0),(0,s._)([(0,u.Cb)()],d.prototype,"parent",void 0),(0,s._)([(0,u.Cb)({readOnly:!0})],d.prototype,"suspended",null),(0,s._)([(0,u.Cb)({readOnly:!0})],d.prototype,"suspendInfo",null),(0,s._)([(0,u.Cb)({readOnly:!0})],d.prototype,"legendEnabled",null),(0,s._)([(0,u.Cb)({type:Boolean,readOnly:!0})],d.prototype,"updating",null),(0,s._)([(0,u.Cb)({readOnly:!0})],d.prototype,"updatingProgress",null),(0,s._)([(0,u.Cb)()],d.prototype,"visible",null),(0,s._)([(0,u.Cb)()],d.prototype,"view",void 0),d=(0,s._)([(0,p.j)("esri.views.layers.LayerView")],d);const f=d}}]);
//# sourceMappingURL=80068.2d11480a.chunk.js.map